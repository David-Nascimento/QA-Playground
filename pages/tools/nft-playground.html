<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>NFT Playground ‚Äî Testes N√£o Funcionais ‚Äî QA Playground</title>
    <link rel="stylesheet" href="../../css/main.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
      /* NFT Playground Styles */
      .test-type-btn {
        padding: var(--spacing-md);
        border: 2px solid rgba(122, 168, 116, 0.3);
        border-radius: var(--border-radius-md);
        background: var(--surface);
        color: var(--text);
        cursor: pointer;
        transition: all var(--transition);
        text-align: left;
      }
      .test-type-btn:hover:not(:disabled) {
        border-color: var(--accent);
        background: rgba(122, 168, 116, 0.1);
        transform: translateY(-2px);
        box-shadow: var(--shadow-sm);
      }
      .test-type-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .test-type-btn.active {
        border-color: var(--accent);
        background: rgba(122, 168, 116, 0.15);
      }
      .config-input-group {
        margin-bottom: var(--spacing-md);
      }
      .config-input-group label {
        display: block;
        margin-bottom: var(--spacing-xs);
        font-weight: 600;
        color: var(--text);
      }
      .config-input-group input[type="number"],
      .config-input-group input[type="range"],
      .config-input-group select {
        width: 100%;
        padding: var(--spacing-sm);
        border: 1px solid rgba(0, 0, 0, 0.1);
        border-radius: var(--border-radius-sm);
        font-size: var(--font-size-base);
      }
      .config-input-group input[type="range"] {
        padding: 0;
      }
      .config-input-group .input-value {
        display: inline-block;
        margin-left: var(--spacing-sm);
        font-weight: 600;
        color: var(--accent);
      }
      #test-log {
        scrollbar-width: thin;
        scrollbar-color: var(--accent) rgba(0, 0, 0, 0.1);
      }
      #test-log::-webkit-scrollbar {
        width: 8px;
      }
      #test-log::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.05);
        border-radius: var(--border-radius-sm);
      }
      #test-log::-webkit-scrollbar-thumb {
        background: var(--accent);
        border-radius: var(--border-radius-sm);
      }
      .log-entry {
        margin-bottom: var(--spacing-xs);
        padding: var(--spacing-xs);
        border-radius: var(--border-radius-sm);
      }
      .log-entry.info {
        background: rgba(122, 168, 116, 0.1);
        color: var(--accent);
      }
      .log-entry.warning {
        background: rgba(255, 193, 7, 0.2);
        color: #856404;
      }
      .log-entry.error {
        background: rgba(220, 53, 69, 0.1);
        color: #721c24;
      }
      .log-entry.success {
        background: rgba(40, 167, 69, 0.1);
        color: #155724;
      }
      .log-timestamp {
        color: var(--muted);
        font-size: 0.9em;
        margin-right: var(--spacing-sm);
      }
      .metric-card {
        background: rgba(0, 0, 0, 0.03);
        padding: var(--spacing-md);
        border-radius: var(--border-radius-md);
        text-align: center;
        border-left: 3px solid var(--accent);
      }
      .metric-card .metric-value {
        font-size: 1.5em;
        font-weight: 700;
        color: var(--accent);
        margin: var(--spacing-xs) 0;
      }
      .metric-card .metric-label {
        font-size: var(--font-size-sm);
        color: var(--muted);
      }
      .test-element {
        display: inline-block;
        padding: var(--spacing-xs) var(--spacing-sm);
        margin: var(--spacing-xs);
        background: var(--accent);
        color: white;
        border-radius: var(--border-radius-sm);
        font-size: var(--font-size-sm);
        animation: fadeIn 0.3s ease;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.9); }
        to { opacity: 1; transform: scale(1); }
      }
      .cooldown-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }
      .cooldown-overlay.show {
        display: flex;
      }
      .cooldown-message {
        background: var(--surface);
        padding: var(--spacing-xl);
        border-radius: var(--border-radius-lg);
        text-align: center;
        box-shadow: var(--shadow-lg);
      }
      .cooldown-timer {
        font-size: 2em;
        font-weight: 700;
        color: var(--accent);
        margin: var(--spacing-md) 0;
      }
      .playground-container {
        max-width: 1200px;
        margin: 0 auto;
      }
      .info-banner {
        background: rgba(255, 248, 200, 0.3);
        border-left: 4px solid var(--accent);
        padding: var(--spacing-md);
        border-radius: var(--border-radius-md);
        margin-bottom: var(--spacing-lg);
      }
      .info-banner h4 {
        margin-top: 0;
        color: var(--accent);
      }
    </style>
  </head>
  <body>
    <header class="et-header">
      <div class="et-header-inner">
        <a href="../../index.html" class="et-logo" aria-label="In√≠cio">
          <img src="../../assets/icons/logo.svg" alt="Logo QA Playground" height="40" />
        </a>
        <nav class="et-nav" aria-label="Navega√ß√£o principal">
          <ul class="et-nav-list">
            <li><a href="../../index.html">In√≠cio</a></li>
            <li><a href="mobile-playground.html">Mobile Playground</a></li>
            <li><a href="nft-playground.html">NFT Playground</a></li>
            <li class="nav-dropdown">
              <button class="dropdown-toggle" aria-expanded="false" aria-haspopup="true">Desafio</button>
              <ul class="dropdown-menu">
                <li><a href="../desafio/junior.html">Desafios J√∫nior</a></li>
                <li><a href="../desafio/pleno.html">Desafios Pleno</a></li>
                <li><a href="../desafio/senior.html">Desafios S√™nior</a></li>
              </ul>
            </li>
          </ul>
        </nav>
        <div class="et-header-actions">
          <button id="theme-toggle" aria-label="Alternar tema">üåû</button>
        </div>
      </div>
    </header>

    <main class="container">
      <section class="section">
        <div class="section-header">
          <h2>NFT Playground - Simulador de Testes N√£o Funcionais</h2>
          <div class="section-desc">
            Ambiente educacional 100% client-side para simula√ß√£o de Testes N√£o Funcionais (NFT). 
            Este playground permite avaliar performance percebida, resili√™ncia e comportamento do front-end 
            sem aplicar carga real a servidores externos.
          </div>
        </div>

        <div class="playground-container">
          <!-- Banner Informativo -->
          <div class="info-banner">
            <h4>Importante: Ambiente Educacional</h4>
            <p>
              <strong>Todos os cen√°rios s√£o simulados localmente no navegador.</strong> 
              Nenhum teste de carga real √© executado e nenhuma chamada agressiva √© feita a servidores externos. 
              Este ambiente √© destinado exclusivamente para fins educacionais e de aprendizado.
            </p>
          </div>

          <!-- Controles de Sess√£o -->
          <div class="content-card" style="background: rgba(122, 168, 116, 0.1); border-left-color: var(--accent); margin-bottom: var(--spacing-lg);">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: var(--spacing-md);">
              <div>
                <h5 style="margin: 0;">Sess√£o NFT Ativa</h5>
                <p style="margin: var(--spacing-xs) 0 0 0; font-size: var(--font-size-sm); color: var(--muted);">
                  Testes executados nesta sess√£o: <strong id="session-count">0</strong> / <strong id="session-limit">10</strong>
                </p>
              </div>
              <button id="reset-session-btn" class="btn btn-secondary" style="white-space: nowrap;">
                Encerrar Sess√£o NFT
              </button>
            </div>
          </div>

          <!-- Sele√ß√£o de Tipo de Teste -->
          <div class="content-card" style="margin-bottom: var(--spacing-lg);">
            <h5>Selecione o Tipo de Teste NFT</h5>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-md); margin-top: var(--spacing-md);">
              <button class="test-type-btn" data-test="performance">
                <strong>Performance Percebida</strong>
                <span style="display: block; font-size: var(--font-size-sm); margin-top: var(--spacing-xs); color: var(--muted);">
                  Simula tempo de renderiza√ß√£o e resposta
                </span>
              </button>
              <button class="test-type-btn" data-test="load">
                <strong>Carga de UI</strong>
                <span style="display: block; font-size: var(--font-size-sm); margin-top: var(--spacing-xs); color: var(--muted);">
                  Testa quantidade de elementos renderizados
                </span>
              </button>
              <button class="test-type-btn" data-test="stress">
                <strong>Stress de Interface</strong>
                <span style="display: block; font-size: var(--font-size-sm); margin-top: var(--spacing-xs); color: var(--muted);">
                  Simula a√ß√µes repetidas do usu√°rio
                </span>
              </button>
              <button class="test-type-btn" data-test="resilience">
                <strong>Resili√™ncia Front-end</strong>
                <span style="display: block; font-size: var(--font-size-sm); margin-top: var(--spacing-xs); color: var(--muted);">
                  Testa lat√™ncia e falha simuladas
                </span>
              </button>
            </div>
          </div>

          <!-- Painel de Configura√ß√£o -->
          <div id="test-config-panel" class="content-card" style="margin-bottom: var(--spacing-lg); display: none;">
            <h5 id="test-config-title">Configura√ß√£o do Teste</h5>
            <div id="test-config-content"></div>
            <div style="display: flex; gap: var(--spacing-md); margin-top: var(--spacing-md); flex-wrap: wrap;">
              <button id="start-test-btn" class="btn btn-primary">
                Iniciar Teste
              </button>
              <button id="cancel-test-btn" class="btn btn-secondary">
                Cancelar
              </button>
            </div>
          </div>

          <!-- √Årea de Resultados -->
          <div id="test-results-area" class="content-card" style="margin-bottom: var(--spacing-lg); display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md);">
              <h5 style="margin: 0;">Resultados do Teste</h5>
              <button id="clear-results-btn" class="btn btn-secondary" style="font-size: var(--font-size-sm);">
                Limpar
              </button>
            </div>
            <div id="test-visual-area" style="min-height: 200px; border: 2px dashed rgba(0, 0, 0, 0.1); border-radius: var(--border-radius-md); padding: var(--spacing-md); margin-bottom: var(--spacing-md); background: rgba(0, 0, 0, 0.02);">
              <!-- √Årea onde os elementos de teste ser√£o renderizados -->
            </div>
            <div id="test-metrics" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: var(--spacing-md); margin-bottom: var(--spacing-md);">
              <!-- M√©tricas ser√£o inseridas aqui -->
            </div>
          </div>

          <!-- Log de Execu√ß√£o -->
          <div class="content-card" style="margin-bottom: var(--spacing-lg);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md);">
              <h5 style="margin: 0;">Log de Execu√ß√£o</h5>
              <button id="clear-log-btn" class="btn btn-secondary" style="font-size: var(--font-size-sm);">
                Limpar Log
              </button>
            </div>
            <div id="test-log" style="background: rgba(0, 0, 0, 0.05); border-radius: var(--border-radius-md); padding: var(--spacing-md); max-height: 400px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: var(--font-size-sm); line-height: 1.6;">
              <div style="color: var(--muted); font-style: italic;">Aguardando execu√ß√£o de testes...</div>
            </div>
          </div>

          <!-- Informa√ß√µes e Limites -->
          <div class="content-card" style="background: rgba(255, 248, 200, 0.3);">
            <h5>Informa√ß√µes sobre Limites e Prote√ß√µes</h5>
            <ul style="margin: var(--spacing-sm) 0; padding-left: var(--spacing-lg);">
              <li><strong>Limite de testes por sess√£o:</strong> 10 execu√ß√µes</li>
              <li><strong>Cooldown entre testes:</strong> 3 segundos</li>
              <li><strong>Limite m√°ximo de elementos:</strong> 1000 itens</li>
              <li><strong>Limite m√°ximo de lat√™ncia simulada:</strong> 5 segundos</li>
              <li><strong>Limite de a√ß√µes simult√¢neas:</strong> 1 teste por vez</li>
            </ul>
            <p style="margin-top: var(--spacing-sm); font-size: var(--font-size-sm);">
              Estes limites existem para proteger infraestrutura e garantir uso respons√°vel deste ambiente educacional.
            </p>
          </div>
        </div>

        <div style="margin-top: var(--spacing-xl); text-align: center;">
          <a href="../../index.html" class="btn btn-secondary">‚Üê Voltar para In√≠cio</a>
          <a href="../fundamentos.html#testes-nao-funcionais" class="btn btn-secondary" style="margin-left: var(--spacing-md);">
            Ver Documenta√ß√£o NFT
          </a>
          <a href="nft/index.html" class="btn btn-primary" style="margin-left: var(--spacing-md);">
            Cen√°rios de Teste NFT
          </a>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div style="display: flex; flex-direction: column; gap: var(--spacing-xs); align-items: center; text-align: center;">
        <div>QA Playground ‚Äî Projeto educacional ‚Ä¢ Portugu√™s</div>
        <div style="font-size: var(--font-size-sm); color: var(--muted);">
          Desenvolvido por <strong>David Nascimento</strong> ‚Ä¢ Licenciado sob <a href="../../LICENSE" style="color: var(--accent);">MIT License</a>
        </div>
      </div>
    </footer>

    <script type="module" src="../../js/index.js"></script>
    <script>
      // NFT Playground - Sistema de Testes N√£o Funcionais
      (function() {
        'use strict';

        // Limites e Configura√ß√µes
        const LIMITS = {
          SESSION_MAX_TESTS: 10,
          COOLDOWN_SECONDS: 3,
          MAX_ELEMENTS: 1000,
          MAX_LATENCY_MS: 5000,
          MAX_ACTIONS: 100
        };

        // Estado da Aplica√ß√£o
        let state = {
          sessionCount: 0,
          lastTestTime: 0,
          currentTest: null,
          isRunning: false,
          cooldownEndTime: 0
        };

        // Elementos DOM
        const elements = {
          sessionCount: document.getElementById('session-count'),
          sessionLimit: document.getElementById('session-limit'),
          resetSessionBtn: document.getElementById('reset-session-btn'),
          testTypeBtns: document.querySelectorAll('.test-type-btn'),
          configPanel: document.getElementById('test-config-panel'),
          configTitle: document.getElementById('test-config-title'),
          configContent: document.getElementById('test-config-content'),
          startTestBtn: document.getElementById('start-test-btn'),
          cancelTestBtn: document.getElementById('cancel-test-btn'),
          resultsArea: document.getElementById('test-results-area'),
          visualArea: document.getElementById('test-visual-area'),
          metricsArea: document.getElementById('test-metrics'),
          logArea: document.getElementById('test-log'),
          clearLogBtn: document.getElementById('clear-log-btn'),
          clearResultsBtn: document.getElementById('clear-results-btn'),
          cooldownOverlay: null
        };

        // Inicializa√ß√£o
        function init() {
          loadSessionState();
          updateSessionDisplay();
          setupEventListeners();
          createCooldownOverlay();
          log('info', 'NFT Playground inicializado. Sess√£o ativa.');
        }

        // Gerenciamento de Sess√£o
        function loadSessionState() {
          const saved = sessionStorage.getItem('nft-playground-session');
          if (saved) {
            const data = JSON.parse(saved);
            state.sessionCount = data.sessionCount || 0;
            state.lastTestTime = data.lastTestTime || 0;
            state.cooldownEndTime = data.cooldownEndTime || 0;
          }
        }

        function saveSessionState() {
          sessionStorage.setItem('nft-playground-session', JSON.stringify({
            sessionCount: state.sessionCount,
            lastTestTime: state.lastTestTime,
            cooldownEndTime: state.cooldownEndTime
          }));
        }

        function resetSession() {
          state.sessionCount = 0;
          state.lastTestTime = 0;
          state.cooldownEndTime = 0;
          state.currentTest = null;
          state.isRunning = false;
          sessionStorage.removeItem('nft-playground-session');
          updateSessionDisplay();
          clearLog();
          clearResults();
          log('info', 'Sess√£o NFT encerrada. Contadores reiniciados.');
        }

        function updateSessionDisplay() {
          if (elements.sessionCount) {
            elements.sessionCount.textContent = state.sessionCount;
          }
          if (elements.sessionLimit) {
            elements.sessionLimit.textContent = LIMITS.SESSION_MAX_TESTS;
          }
        }

        // Sistema de Logs
        function log(type, message) {
          if (!elements.logArea) return;

          const timestamp = new Date().toLocaleTimeString('pt-BR');
          const entry = document.createElement('div');
          entry.className = `log-entry ${type}`;
          entry.innerHTML = `<span class="log-timestamp">[${timestamp}]</span>${message}`;
          
          elements.logArea.appendChild(entry);
          elements.logArea.scrollTop = elements.logArea.scrollHeight;

          // Remove mensagem inicial se existir
          const initialMsg = elements.logArea.querySelector('div[style*="color: var(--muted)"]');
          if (initialMsg) {
            initialMsg.remove();
          }
        }

        function clearLog() {
          if (elements.logArea) {
            elements.logArea.innerHTML = '<div style="color: var(--muted); font-style: italic;">Aguardando execu√ß√£o de testes...</div>';
          }
        }

        // Sistema de Cooldown
        function createCooldownOverlay() {
          const overlay = document.createElement('div');
          overlay.className = 'cooldown-overlay';
          overlay.id = 'cooldown-overlay';
          overlay.innerHTML = `
            <div class="cooldown-message">
              <h4>Cooldown Ativo</h4>
              <div class="cooldown-timer" id="cooldown-timer">3</div>
              <p>Aguarde alguns segundos antes de iniciar um novo teste.</p>
            </div>
          `;
          document.body.appendChild(overlay);
          elements.cooldownOverlay = overlay;
        }

        function checkCooldown() {
          const now = Date.now();
          if (state.cooldownEndTime > now) {
            const remaining = Math.ceil((state.cooldownEndTime - now) / 1000);
            showCooldown(remaining);
            return false;
          }
          hideCooldown();
          return true;
        }

        function showCooldown(seconds) {
          if (!elements.cooldownOverlay) return;
          elements.cooldownOverlay.classList.add('show');
          const timer = document.getElementById('cooldown-timer');
          if (timer) timer.textContent = seconds;
          
          if (seconds > 0) {
            setTimeout(() => {
              const remaining = Math.ceil((state.cooldownEndTime - Date.now()) / 1000);
              if (remaining > 0) {
                showCooldown(remaining);
              } else {
                hideCooldown();
              }
            }, 1000);
          }
        }

        function hideCooldown() {
          if (elements.cooldownOverlay) {
            elements.cooldownOverlay.classList.remove('show');
          }
        }

        function startCooldown() {
          state.cooldownEndTime = Date.now() + (LIMITS.COOLDOWN_SECONDS * 1000);
          saveSessionState();
        }

        // Valida√ß√£o de Par√¢metros
        function validateParams(testType, params) {
          switch(testType) {
            case 'performance':
              if (params.elements > LIMITS.MAX_ELEMENTS) {
                return { valid: false, message: `Par√¢metro excede o limite permitido. M√°ximo de elementos: ${LIMITS.MAX_ELEMENTS}.` };
              }
              if (params.latency > LIMITS.MAX_LATENCY_MS) {
                return { valid: false, message: `Par√¢metro excede o limite permitido. M√°xima lat√™ncia: ${LIMITS.MAX_LATENCY_MS}ms.` };
              }
              break;
            case 'load':
              if (params.count > LIMITS.MAX_ELEMENTS) {
                return { valid: false, message: `Par√¢metro excede o limite permitido. M√°ximo de elementos: ${LIMITS.MAX_ELEMENTS}.` };
              }
              break;
            case 'stress':
              if (params.iterations > LIMITS.MAX_ACTIONS) {
                return { valid: false, message: `Par√¢metro excede o limite permitido. M√°ximo de a√ß√µes: ${LIMITS.MAX_ACTIONS}.` };
              }
              break;
            case 'resilience':
              if (params.failures > LIMITS.MAX_ACTIONS) {
                return { valid: false, message: `Par√¢metro excede o limite permitido. M√°ximo de falhas simuladas: ${LIMITS.MAX_ACTIONS}.` };
              }
              if (params.latency > LIMITS.MAX_LATENCY_MS) {
                return { valid: false, message: `Par√¢metro excede o limite permitido. M√°xima lat√™ncia: ${LIMITS.MAX_LATENCY_MS}ms.` };
              }
              break;
          }
          return { valid: true };
        }

        // Verifica√ß√£o de Limites
        function canRunTest() {
          // Verifica limite de sess√£o
          if (state.sessionCount >= LIMITS.SESSION_MAX_TESTS) {
            log('warning', 'Limite de testes por sess√£o atingido. Reinicie a sess√£o para continuar.');
            return { allowed: false, message: 'Limite de testes por sess√£o atingido. Reinicie a sess√£o para continuar.' };
          }

          // Verifica se h√° teste em execu√ß√£o
          if (state.isRunning) {
            log('warning', 'J√° existe um teste em execu√ß√£o. Aguarde a conclus√£o.');
            return { allowed: false, message: 'J√° existe um teste em execu√ß√£o. Aguarde a conclus√£o.' };
          }

          // Verifica cooldown
          if (!checkCooldown()) {
            const remaining = Math.ceil((state.cooldownEndTime - Date.now()) / 1000);
            log('warning', `Cooldown ativo. Aguarde ${remaining} segundo(s) antes de iniciar um novo teste.`);
            return { allowed: false, message: `Cooldown ativo. Aguarde alguns segundos antes de iniciar um novo teste.` };
          }

          return { allowed: true };
        }

        // Configura√ß√£o de Testes
        function showTestConfig(testType) {
          elements.configPanel.style.display = 'block';
          elements.configContent.innerHTML = '';

          let configHTML = '';

          switch(testType) {
            case 'performance':
              elements.configTitle.textContent = 'Teste de Performance Percebida';
              configHTML = `
                <div class="config-input-group">
                  <label>
                    N√∫mero de Elementos:
                    <input type="number" id="perf-elements" min="1" max="${LIMITS.MAX_ELEMENTS}" value="100">
                    <span class="input-value" id="perf-elements-value">100</span>
                  </label>
                </div>
                <div class="config-input-group">
                  <label>
                    Lat√™ncia Simulada (ms):
                    <input type="range" id="perf-latency" min="0" max="${LIMITS.MAX_LATENCY_MS}" step="100" value="500">
                    <span class="input-value" id="perf-latency-value">500ms</span>
                  </label>
                </div>
              `;
              break;
            case 'load':
              elements.configTitle.textContent = 'Teste de Carga de UI';
              configHTML = `
                <div class="config-input-group">
                  <label>
                    Quantidade de Elementos:
                    <input type="number" id="load-count" min="1" max="${LIMITS.MAX_ELEMENTS}" value="50">
                    <span class="input-value" id="load-count-value">50</span>
                  </label>
                </div>
                <div class="config-input-group">
                  <label>
                    Tamanho dos Elementos:
                    <select id="load-size">
                      <option value="small">Pequeno</option>
                      <option value="medium" selected>M√©dio</option>
                      <option value="large">Grande</option>
                    </select>
                  </label>
                </div>
              `;
              break;
            case 'stress':
              elements.configTitle.textContent = 'Teste de Stress de Interface';
              configHTML = `
                <div class="config-input-group">
                  <label>
                    Itera√ß√µes:
                    <input type="number" id="stress-iterations" min="1" max="${LIMITS.MAX_ACTIONS}" value="10">
                    <span class="input-value" id="stress-iterations-value">10</span>
                  </label>
                </div>
                <div class="config-input-group">
                  <label>
                    A√ß√µes por Itera√ß√£o:
                    <input type="number" id="stress-actions" min="1" max="20" value="5">
                    <span class="input-value" id="stress-actions-value">5</span>
                  </label>
                </div>
              `;
              break;
            case 'resilience':
              elements.configTitle.textContent = 'Teste de Resili√™ncia Front-end';
              configHTML = `
                <div class="config-input-group">
                  <label>
                    Lat√™ncia Simulada (ms):
                    <input type="range" id="res-latency" min="0" max="${LIMITS.MAX_LATENCY_MS}" step="100" value="1000">
                    <span class="input-value" id="res-latency-value">1000ms</span>
                  </label>
                </div>
                <div class="config-input-group">
                  <label>
                    Taxa de Falha Simulada (%):
                    <input type="range" id="res-failures" min="0" max="50" step="5" value="10">
                    <span class="input-value" id="res-failures-value">10%</span>
                  </label>
                </div>
                <div class="config-input-group">
                  <label>
                    Tentativas:
                    <input type="number" id="res-attempts" min="1" max="20" value="5">
                    <span class="input-value" id="res-attempts-value">5</span>
                  </label>
                </div>
              `;
              break;
          }

          elements.configContent.innerHTML = configHTML;
          
          // Adiciona listeners para atualizar valores em tempo real
          elements.configContent.querySelectorAll('input[type="range"]').forEach(input => {
            const valueSpan = document.getElementById(input.id + '-value');
            input.addEventListener('input', () => {
              if (input.id.includes('latency') || input.id.includes('res-latency')) {
                valueSpan.textContent = input.value + 'ms';
              } else if (input.id.includes('failures')) {
                valueSpan.textContent = input.value + '%';
              } else {
                valueSpan.textContent = input.value;
              }
            });
          });

          elements.configContent.querySelectorAll('input[type="number"]').forEach(input => {
            const valueSpan = document.getElementById(input.id + '-value');
            if (valueSpan) {
              input.addEventListener('input', () => {
                valueSpan.textContent = input.value;
              });
            }
          });

          state.currentTest = testType;
        }

        // Execu√ß√£o de Testes
        async function runTest() {
          const check = canRunTest();
          if (!check.allowed) {
            alert(check.message);
            return;
          }

          const params = getTestParams(state.currentTest);
          const validation = validateParams(state.currentTest, params);
          
          if (!validation.valid) {
            log('error', validation.message);
            alert(validation.message);
            return;
          }

          state.isRunning = true;
          state.sessionCount++;
          saveSessionState();
          updateSessionDisplay();
          startCooldown();

          elements.startTestBtn.disabled = true;
          elements.testTypeBtns.forEach(btn => btn.disabled = true);
          elements.resultsArea.style.display = 'block';
          elements.visualArea.innerHTML = '';
          elements.metricsArea.innerHTML = '';

          const startTime = performance.now();
          log('info', `Iniciando teste: ${state.currentTest}`);
          log('info', `Par√¢metros: ${JSON.stringify(params)}`);

          try {
            switch(state.currentTest) {
              case 'performance':
                await runPerformanceTest(params);
                break;
              case 'load':
                await runLoadTest(params);
                break;
              case 'stress':
                await runStressTest(params);
                break;
              case 'resilience':
                await runResilienceTest(params);
                break;
            }

            const endTime = performance.now();
            const duration = ((endTime - startTime) / 1000).toFixed(2);
            log('success', `Teste conclu√≠do com sucesso em ${duration}s`);
            state.lastTestTime = Date.now();
            saveSessionState();

          } catch (error) {
            log('error', `Falha durante execu√ß√£o: ${error.message}`);
          } finally {
            state.isRunning = false;
            elements.startTestBtn.disabled = false;
            elements.testTypeBtns.forEach(btn => btn.disabled = false);
          }
        }

        function getTestParams(testType) {
          switch(testType) {
            case 'performance':
              return {
                elements: Number.parseInt(document.getElementById('perf-elements').value, 10) || 100,
                latency: Number.parseInt(document.getElementById('perf-latency').value, 10) || 500
              };
            case 'load':
              return {
                count: Number.parseInt(document.getElementById('load-count').value, 10) || 50,
                size: document.getElementById('load-size').value || 'medium'
              };
            case 'stress':
              return {
                iterations: Number.parseInt(document.getElementById('stress-iterations').value, 10) || 10,
                actions: Number.parseInt(document.getElementById('stress-actions').value, 10) || 5
              };
            case 'resilience':
              return {
                latency: Number.parseInt(document.getElementById('res-latency').value, 10) || 1000,
                failures: Number.parseInt(document.getElementById('res-failures').value, 10) || 10,
                attempts: Number.parseInt(document.getElementById('res-attempts').value, 10) || 5
              };
            default:
              return {};
          }
        }

        // Implementa√ß√£o dos Testes
        async function runPerformanceTest(params) {
          const { elements: count, latency } = params;
          
          log('info', `Renderizando ${count} elementos com lat√™ncia de ${latency}ms...`);
          
          const renderStartTime = performance.now();
          await simulateLatency(latency);
          
          for (let i = 0; i < count; i++) {
            const el = document.createElement('div');
            el.className = 'test-element';
            el.textContent = `Elemento ${i + 1}`;
            elements.visualArea.appendChild(el);
            
            if (i % 10 === 0) {
              await new Promise(resolve => setTimeout(resolve, 10));
            }
          }

          const renderEndTime = performance.now();
          const renderDuration = ((renderEndTime - renderStartTime) / 1000).toFixed(2);
          displayMetrics([
            { label: 'Elementos Renderizados', value: count },
            { label: 'Lat√™ncia Simulada', value: latency + 'ms' },
            { label: 'Tempo de Renderiza√ß√£o', value: renderDuration + 's' }
          ]);
        }

        async function runLoadTest(params) {
          const { count, size } = params;
          const sizeMap = { small: '8px', medium: '12px', large: '16px' };
          
          log('info', `Carregando ${count} elementos de tamanho ${size}...`);
          
          elements.visualArea.style.fontSize = sizeMap[size];
          
          for (let i = 0; i < count; i++) {
            const el = document.createElement('div');
            el.className = 'test-element';
            el.textContent = `#${i + 1}`;
            elements.visualArea.appendChild(el);
            
            if (i % 20 === 0) {
              await new Promise(resolve => setTimeout(resolve, 5));
            }
          }

          displayMetrics([
            { label: 'Total de Elementos', value: count },
            { label: 'Tamanho', value: size },
            { label: 'Mem√≥ria Aproximada', value: (count * 0.5).toFixed(0) + ' KB' }
          ]);
        }

        async function runStressTest(params) {
          const { iterations, actions } = params;
          
          log('info', `Executando ${iterations} itera√ß√µes com ${actions} a√ß√µes cada...`);
          
          let totalActions = 0;
          
          for (let i = 0; i < iterations; i++) {
            log('info', `Itera√ß√£o ${i + 1}/${iterations}`);
            
            for (let j = 0; j < actions; j++) {
              const el = document.createElement('div');
              el.className = 'test-element';
              el.textContent = `A√ß√£o ${totalActions + 1}`;
              elements.visualArea.appendChild(el);
              totalActions++;
              
              await new Promise(resolve => setTimeout(resolve, 50));
            }
            
            // Limpa parcialmente a cada 5 itera√ß√µes
            if ((i + 1) % 5 === 0) {
              const children = elements.visualArea.children;
              const toRemove = Math.floor(children.length / 2);
              for (let k = 0; k < toRemove; k++) {
                if (children[0]) children[0].remove();
              }
            }
          }

          displayMetrics([
            { label: 'Itera√ß√µes', value: iterations },
            { label: 'A√ß√µes Totais', value: totalActions },
            { label: 'A√ß√µes por Itera√ß√£o', value: actions }
          ]);
        }

        async function runResilienceTest(params) {
          const { latency, failures, attempts } = params;
          
          log('info', `Testando resili√™ncia com ${latency}ms de lat√™ncia e ${failures}% de falhas...`);
          
          let successCount = 0;
          let failureCount = 0;
          
          for (let i = 0; i < attempts; i++) {
            log('info', `Tentativa ${i + 1}/${attempts}...`);
            
            await simulateLatency(latency);
            
            const shouldFail = Math.random() * 100 < failures;
            
            if (shouldFail) {
              failureCount++;
              log('warning', `Falha simulada na tentativa ${i + 1}`);
              
              const el = document.createElement('div');
              el.className = 'test-element';
              el.style.background = '#dc3545';
              el.textContent = `Falha ${failureCount}`;
              elements.visualArea.appendChild(el);
            } else {
              successCount++;
              
              const el = document.createElement('div');
              el.className = 'test-element';
              el.style.background = '#28a745';
              el.textContent = `Sucesso ${successCount}`;
              elements.visualArea.appendChild(el);
            }
            
            await new Promise(resolve => setTimeout(resolve, 200));
          }

          const successRate = ((successCount / attempts) * 100).toFixed(1);
          
          displayMetrics([
            { label: 'Tentativas', value: attempts },
            { label: 'Sucessos', value: successCount },
            { label: 'Falhas', value: failureCount },
            { label: 'Taxa de Sucesso', value: successRate + '%' }
          ]);
        }

        function simulateLatency(ms) {
          return new Promise(resolve => setTimeout(resolve, ms));
        }

        function displayMetrics(metrics) {
          elements.metricsArea.innerHTML = metrics.map(m => `
            <div class="metric-card">
              <div class="metric-label">${m.label}</div>
              <div class="metric-value">${m.value}</div>
            </div>
          `).join('');
        }

        function clearResults() {
          elements.visualArea.innerHTML = '';
          elements.metricsArea.innerHTML = '';
          elements.resultsArea.style.display = 'none';
        }

        // Event Listeners
        function setupEventListeners() {
          // Reset de sess√£o
          if (elements.resetSessionBtn) {
            elements.resetSessionBtn.addEventListener('click', () => {
              if (confirm('Deseja realmente encerrar a sess√£o NFT? Todos os contadores ser√£o reiniciados.')) {
                resetSession();
              }
            });
          }

          // Sele√ß√£o de tipo de teste
          elements.testTypeBtns.forEach(btn => {
            btn.addEventListener('click', () => {
              if (state.isRunning) return;
              
              elements.testTypeBtns.forEach(b => b.classList.remove('active'));
              btn.classList.add('active');
              showTestConfig(btn.dataset.test);
            });
          });

          // Iniciar teste
          if (elements.startTestBtn) {
            elements.startTestBtn.addEventListener('click', runTest);
          }

          // Cancelar teste
          if (elements.cancelTestBtn) {
            elements.cancelTestBtn.addEventListener('click', () => {
              elements.configPanel.style.display = 'none';
              elements.testTypeBtns.forEach(btn => btn.classList.remove('active'));
              state.currentTest = null;
            });
          }

          // Limpar log
          if (elements.clearLogBtn) {
            elements.clearLogBtn.addEventListener('click', clearLog);
          }

          // Limpar resultados
          if (elements.clearResultsBtn) {
            elements.clearResultsBtn.addEventListener('click', clearResults);
          }
        }

        // Inicializar quando DOM estiver pronto
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', init);
        } else {
          init();
        }

        // Verificar cooldown periodicamente
        setInterval(() => {
          if (state.cooldownEndTime > 0 && state.cooldownEndTime <= Date.now()) {
            hideCooldown();
          }
        }, 1000);
      })();
    </script>
  </body>
</html>
