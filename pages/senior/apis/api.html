<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>API Playground ‚Äî QA Playground</title>
    <link rel="stylesheet" href="../../../css/main.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  </head>
  <body>
    <header class="et-header">
      <div class="et-header-inner">
        <a href="../../../index.html" class="et-logo" aria-label="In√≠cio">
          <img src="../../../assets/icons/logo.svg" alt="Logo QA Playground" height="40" />
        </a>
        <nav class="et-nav" aria-label="Navega√ß√£o principal">
          <ul class="et-nav-list">
            <li><a href="../../../index.html">In√≠cio</a></li>
            <li><a href="api.html" aria-current="page">API</a></li>
            <li><a href="../../pleno/tabelas/">Tabelas</a></li>
          </ul>
        </nav>
        <div class="et-header-actions">
          <button id="theme-toggle" aria-label="Alternar tema">üåû</button>
        </div>
      </div>
    </header>

    <main class="container">
      <section class="section">
        <div class="section-header">
          <h2>API Playground (Mock)</h2>
          <div class="section-desc">Simule chamadas de API REST para testar integra√ß√£o e valida√ß√£o de respostas. Endpoints mockados para pr√°tica de testes de API.</div>
        </div>

        <div class="subsections subsections-vertical">
          <div class="subsection">
            <h3>GET /users</h3>
            <p class="muted" style="margin-bottom: var(--spacing-md);">Buscar lista de usu√°rios (simulado).</p>
            <div class="controls">
              <button id="btn-fetch-users" class="btn" data-testid="btn-get-users">Buscar Usu√°rios</button>
              <button id="btn-clear-users" class="btn btn-secondary" data-testid="btn-clear-users">Limpar</button>
            </div>
            <pre 
              id="api-result-users" 
              data-testid="resultado-api-users"
              style="margin-top: var(--spacing-md); padding: var(--spacing-md); background: var(--surface); border-radius: var(--border-radius-md); border-left: 4px solid var(--accent); overflow-x: auto; font-size: var(--font-size-sm); min-height: 60px;"
            ><span class="muted">Nenhuma requisi√ß√£o realizada ainda.</span></pre>
          </div>

          <div class="subsection">
            <h3>POST /users</h3>
            <p class="muted" style="margin-bottom: var(--spacing-md);">Criar um novo usu√°rio (simulado).</p>
            <div class="form-grid">
              <div class="form-group">
                <label for="user-name">Nome</label>
                <input id="user-name" type="text" placeholder="Digite o nome" data-testid="input-nome-usuario" />
              </div>
              <div class="form-group">
                <label for="user-email">Email</label>
                <input id="user-email" type="email" placeholder="email@exemplo.com" data-testid="input-email-usuario" />
              </div>
              <div class="form-full">
                <button id="btn-create-user" class="btn" data-testid="btn-post-user">Criar Usu√°rio</button>
              </div>
            </div>
            <pre 
              id="api-result-post" 
              data-testid="resultado-api-post"
              style="margin-top: var(--spacing-md); padding: var(--spacing-md); background: var(--surface); border-radius: var(--border-radius-md); border-left: 4px solid var(--accent-2); overflow-x: auto; font-size: var(--font-size-sm); min-height: 60px;"
            ><span class="muted">Nenhuma requisi√ß√£o realizada ainda.</span></pre>
          </div>
        </div>

        <div class="subsection" style="margin-top: var(--spacing-lg);">
          <h3>Informa√ß√µes para Testes</h3>
          <div style="background: var(--surface); padding: var(--spacing-md); border-radius: var(--border-radius-md); border-left: 4px solid var(--accent);">
            <p style="margin-bottom: var(--spacing-sm);"><strong>Cen√°rios de Teste:</strong></p>
            <ul style="margin-left: var(--spacing-lg); color: var(--muted); font-size: var(--font-size-sm);">
              <li>Testar requisi√ß√µes GET e POST</li>
              <li>Validar status codes de resposta</li>
              <li>Verificar estrutura JSON das respostas</li>
              <li>Testar cria√ß√£o de recursos</li>
              <li>Validar tratamento de erros</li>
              <li>Testar timeouts e delays de resposta</li>
            </ul>
            
            <p style="margin-top: var(--spacing-md); margin-bottom: var(--spacing-sm);"><strong>Endpoints Mockados:</strong></p>
            <ul style="margin-left: var(--spacing-lg); color: var(--muted); font-size: var(--font-size-sm);">
              <li><code>GET /users</code> - Retorna lista de usu√°rios</li>
              <li><code>POST /users</code> - Cria um novo usu√°rio</li>
            </ul>

            <p style="margin-top: var(--spacing-md); margin-bottom: var(--spacing-sm);"><strong>Exemplos de Teste Automatizado de API:</strong></p>
            
            <div style="margin-bottom: var(--spacing-md);">
              <h4 style="color: var(--accent); margin-bottom: var(--spacing-sm); font-size: var(--font-size-base);">JavaScript/Node.js (Jest + Axios)</h4>
              <pre style="background: var(--bg); padding: var(--spacing-md); border-radius: var(--border-radius-sm); overflow-x: auto; font-size: var(--font-size-sm); margin-top: var(--spacing-sm);"><code>const axios = require('axios');
const baseURL = 'https://api.example.com';

describe('API Users Tests', () => {
  // GET /users
  test('GET /users deve retornar status 200 e lista de usu√°rios', async () => {
    const response = await axios.get(`${baseURL}/users`);
    
    expect(response.status).toBe(200);
    expect(response.data).toHaveProperty('data');
    expect(Array.isArray(response.data.data)).toBe(true);
    expect(response.data.data.length).toBeGreaterThan(0);
    
    // Validar estrutura de cada usu√°rio
    response.data.data.forEach(user => {
      expect(user).toHaveProperty('id');
      expect(user).toHaveProperty('name');
      expect(user).toHaveProperty('email');
      expect(typeof user.id).toBe('number');
      expect(typeof user.name).toBe('string');
      expect(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(user.email)).toBe(true);
    });
  });

  // POST /users
  test('POST /users deve criar usu√°rio com status 201', async () => {
    const newUser = {
      name: 'Jo√£o Silva',
      email: 'joao@exemplo.com'
    };
    
    const response = await axios.post(`${baseURL}/users`, newUser);
    
    expect(response.status).toBe(201);
    expect(response.data).toHaveProperty('data');
    expect(response.data.data).toHaveProperty('id');
    expect(response.data.data.name).toBe(newUser.name);
    expect(response.data.data.email).toBe(newUser.email);
    expect(response.data).toHaveProperty('timestamp');
  });

  // Valida√ß√£o de erro
  test('POST /users sem email deve retornar 400', async () => {
    try {
      await axios.post(`${baseURL}/users`, { name: 'Jo√£o' });
    } catch (error) {
      expect(error.response.status).toBe(400);
      expect(error.response.data).toHaveProperty('error');
    }
  });
});</code></pre>
            </div>

            <div style="margin-bottom: var(--spacing-md);">
              <h4 style="color: var(--accent); margin-bottom: var(--spacing-sm); font-size: var(--font-size-base);">Python (pytest + requests)</h4>
              <pre style="background: var(--bg); padding: var(--spacing-md); border-radius: var(--border-radius-sm); overflow-x: auto; font-size: var(--font-size-sm); margin-top: var(--spacing-sm);"><code>import pytest
import requests
from jsonschema import validate

BASE_URL = 'https://api.example.com'

def test_get_users_status_200():
    """GET /users deve retornar status 200"""
    response = requests.get(f'{BASE_URL}/users')
    
    assert response.status_code == 200
    assert response.headers['Content-Type'] == 'application/json'
    
    data = response.json()
    assert 'data' in data
    assert isinstance(data['data'], list)
    assert len(data['data']) > 0

def test_get_users_schema():
    """Validar schema JSON da resposta"""
    response = requests.get(f'{BASE_URL}/users')
    data = response.json()
    
    user_schema = {
        'type': 'object',
        'properties': {
            'id': {'type': 'number'},
            'name': {'type': 'string'},
            'email': {'type': 'string', 'format': 'email'}
        },
        'required': ['id', 'name', 'email']
    }
    
    for user in data['data']:
        validate(instance=user, schema=user_schema)

def test_post_users_create():
    """POST /users deve criar usu√°rio com status 201"""
    payload = {
        'name': 'Maria Santos',
        'email': 'maria@exemplo.com'
    }
    
    response = requests.post(f'{BASE_URL}/users', json=payload)
    
    assert response.status_code == 201
    assert response.headers['Content-Type'] == 'application/json'
    
    data = response.json()
    assert data['data']['name'] == payload['name']
    assert data['data']['email'] == payload['email']
    assert 'id' in data['data']

def test_post_users_validation_error():
    """POST /users sem campos obrigat√≥rios deve retornar 400"""
    response = requests.post(f'{BASE_URL}/users', json={'name': 'Teste'})
    
    assert response.status_code == 400
    assert 'error' in response.json()</code></pre>
            </div>

            <div style="margin-bottom: var(--spacing-md);">
              <h4 style="color: var(--accent); margin-bottom: var(--spacing-sm); font-size: var(--font-size-base);">Postman (Test Scripts)</h4>
              <pre style="background: var(--bg); padding: var(--spacing-md); border-radius: var(--border-radius-sm); overflow-x: auto; font-size: var(--font-size-sm); margin-top: var(--spacing-sm);"><code>// Pre-request Script (para vari√°veis din√¢micas)
pm.environment.set('timestamp', new Date().toISOString());
pm.environment.set('randomEmail', `test${Date.now()}@exemplo.com`);

// Test Script - GET /users
pm.test('Status code is 200', function () {
    pm.response.to.have.status(200);
});

pm.test('Response time is less than 500ms', function () {
    pm.expect(pm.response.responseTime).to.be.below(500);
});

pm.test('Response has JSON body', function () {
    pm.response.to.be.json;
});

pm.test('Response contains data array', function () {
    const jsonData = pm.response.json();
    pm.expect(jsonData).to.have.property('data');
    pm.expect(jsonData.data).to.be.an('array');
});

pm.test('Each user has required fields', function () {
    const jsonData = pm.response.json();
    jsonData.data.forEach(user => {
        pm.expect(user).to.have.property('id');
        pm.expect(user).to.have.property('name');
        pm.expect(user).to.have.property('email');
        pm.expect(user.id).to.be.a('number');
    });
});

// Test Script - POST /users
pm.test('Status code is 201', function () {
    pm.response.to.have.status(201);
});

pm.test('Location header is present', function () {
    pm.expect(pm.response.headers.get('Location')).to.exist;
});

pm.test('Created user has correct data', function () {
    const jsonData = pm.response.json();
    pm.expect(jsonData.data.name).to.eql(pm.environment.get('testName'));
    pm.expect(jsonData.data.email).to.eql(pm.environment.get('testEmail'));
});

// Salvar ID para pr√≥ximas requisi√ß√µes
const userId = pm.response.json().data.id;
pm.environment.set('createdUserId', userId);</code></pre>
            </div>

            <div style="margin-bottom: var(--spacing-md);">
              <h4 style="color: var(--accent); margin-bottom: var(--spacing-sm); font-size: var(--font-size-base);">Java (REST Assured)</h4>
              <pre style="background: var(--bg); padding: var(--spacing-md); border-radius: var(--border-radius-sm); overflow-x: auto; font-size: var(--font-size-sm); margin-top: var(--spacing-sm);"><code>import io.restassured.RestAssured;
import io.restassured.http.ContentType;
import org.junit.jupiter.api.Test;
import static io.restassured.RestAssured.given;
import static org.hamcrest.Matchers.*;

public class UsersApiTest {
    private static final String BASE_URL = "https://api.example.com";

    @Test
    public void testGetUsers_ShouldReturn200() {
        given()
            .baseUri(BASE_URL)
        .when()
            .get("/users")
        .then()
            .statusCode(200)
            .contentType(ContentType.JSON)
            .body("status", equalTo(200))
            .body("data", is(not(empty())))
            .body("data.size()", greaterThan(0))
            .body("data[0].id", notNullValue())
            .body("data[0].name", notNullValue())
            .body("data[0].email", matchesPattern("^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$"));
    }

    @Test
    public void testPostUsers_ShouldCreateUser() {
        String requestBody = """
            {
                "name": "Carlos Oliveira",
                "email": "carlos@exemplo.com"
            }
            """;

        given()
            .baseUri(BASE_URL)
            .contentType(ContentType.JSON)
            .body(requestBody)
        .when()
            .post("/users")
        .then()
            .statusCode(201)
            .body("status", equalTo(201))
            .body("data.id", notNullValue())
            .body("data.name", equalTo("Carlos Oliveira"))
            .body("data.email", equalTo("carlos@exemplo.com"))
            .header("Content-Type", containsString("application/json"));
    }

    @Test
    public void testPostUsers_WithoutEmail_ShouldReturn400() {
        String requestBody = """
            {
                "name": "Teste"
            }
            """;

        given()
            .baseUri(BASE_URL)
            .contentType(ContentType.JSON)
            .body(requestBody)
        .when()
            .post("/users")
        .then()
            .statusCode(400)
            .body("error", notNullValue());
    }
}</code></pre>
            </div>

            <div style="margin-bottom: var(--spacing-md);">
              <h4 style="color: var(--accent); margin-bottom: var(--spacing-sm); font-size: var(--font-size-base);">Cypress (Testes de API Diretos)</h4>
              <pre style="background: var(--bg); padding: var(--spacing-md); border-radius: var(--border-radius-sm); overflow-x: auto; font-size: var(--font-size-sm); margin-top: var(--spacing-sm);"><code>describe('API Users - Direct API Tests', () => {
  const baseURL = 'https://api.example.com';

  it('GET /users deve retornar 200 e lista v√°lida', () => {
    cy.request({
      method: 'GET',
      url: `${baseURL}/users`,
      headers: {
        'Content-Type': 'application/json'
      }
    }).then((response) => {
      expect(response.status).to.eq(200);
      expect(response.body).to.have.property('data');
      expect(response.body.data).to.be.an('array');
      expect(response.body.data.length).to.be.greaterThan(0);
      
      // Validar estrutura do primeiro usu√°rio
      const user = response.body.data[0];
      expect(user).to.have.property('id');
      expect(user).to.have.property('name');
      expect(user).to.have.property('email');
      expect(user.email).to.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/);
    });
  });

  it('POST /users deve criar usu√°rio com 201', () => {
    const newUser = {
      name: 'Ana Costa',
      email: 'ana@exemplo.com'
    };

    cy.request({
      method: 'POST',
      url: `${baseURL}/users`,
      body: newUser,
      headers: {
        'Content-Type': 'application/json'
      }
    }).then((response) => {
      expect(response.status).to.eq(201);
      expect(response.body.data.name).to.eq(newUser.name);
      expect(response.body.data.email).to.eq(newUser.email);
      expect(response.body.data).to.have.property('id');
    });
  });

  it('POST /users sem email deve retornar 400', () => {
    cy.request({
      method: 'POST',
      url: `${baseURL}/users`,
      body: { name: 'Teste' },
      failOnStatusCode: false
    }).then((response) => {
      expect(response.status).to.eq(400);
      expect(response.body).to.have.property('error');
    });
  });
});</code></pre>
            </div>

            <p style="margin-top: var(--spacing-md); margin-bottom: var(--spacing-sm);"><strong>Elementos identific√°veis:</strong></p>
            <ul style="margin-left: var(--spacing-lg); color: var(--muted); font-size: var(--font-size-sm);">
              <li><code>data-testid="btn-get-users"</code></li>
              <li><code>data-testid="btn-post-user"</code></li>
              <li><code>data-testid="resultado-api-users"</code></li>
              <li><code>data-testid="resultado-api-post"</code></li>
            </ul>
          </div>
        </div>

        <div style="margin-top: var(--spacing-xl); text-align: center;">
          <a href="../../../index.html" class="btn btn-secondary">‚Üê Voltar para In√≠cio</a>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      QA Playground ‚Äî Projeto educacional ‚Ä¢ Portugu√™s
    </footer>

    <script type="module" src="../../../js/index.js"></script>
    <script>
      let userCounter = 3;
      
      // GET /users
      document.getElementById('btn-fetch-users').addEventListener('click', () => {
        const resultEl = document.getElementById('api-result-users');
        resultEl.innerHTML = '<span class="muted">Carregando...</span>';
        resultEl.style.color = 'var(--muted)';
        
        setTimeout(() => {
          const users = [
            { id: 1, name: 'Ana Silva', email: 'ana@exemplo.com' },
            { id: 2, name: 'Bruno Costa', email: 'bruno@exemplo.com' }
          ];
          
          const response = {
            status: 200,
            statusText: 'OK',
            data: users,
            timestamp: new Date().toISOString()
          };
          
          resultEl.textContent = JSON.stringify(response, null, 2);
          resultEl.style.color = 'var(--text)';
          window.showToast(`GET /users retornou ${users.length} usu√°rios`);
        }, 800);
      });

      document.getElementById('btn-clear-users').addEventListener('click', () => {
        document.getElementById('api-result-users').innerHTML = '<span class="muted">Nenhuma requisi√ß√£o realizada ainda.</span>';
      });

      // POST /users
      document.getElementById('btn-create-user').addEventListener('click', () => {
        const name = document.getElementById('user-name').value.trim();
        const email = document.getElementById('user-email').value.trim();
        const resultEl = document.getElementById('api-result-post');
        
        if (!name || !email) {
          resultEl.innerHTML = JSON.stringify({
            status: 400,
            statusText: 'Bad Request',
            error: 'Nome e email s√£o obrigat√≥rios'
          }, null, 2);
          resultEl.style.color = 'var(--danger)';
          window.showToast('Erro: Preencha todos os campos');
          return;
        }
        
        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
          resultEl.innerHTML = JSON.stringify({
            status: 400,
            statusText: 'Bad Request',
            error: 'Email inv√°lido'
          }, null, 2);
          resultEl.style.color = 'var(--danger)';
          window.showToast('Erro: Email inv√°lido');
          return;
        }
        
        resultEl.innerHTML = '<span class="muted">Criando usu√°rio...</span>';
        resultEl.style.color = 'var(--muted)';
        
        setTimeout(() => {
          const newUser = {
            id: userCounter++,
            name: name,
            email: email,
            createdAt: new Date().toISOString()
          };
          
          const response = {
            status: 201,
            statusText: 'Created',
            data: newUser,
            message: 'Usu√°rio criado com sucesso',
            timestamp: new Date().toISOString()
          };
          
          resultEl.textContent = JSON.stringify(response, null, 2);
          resultEl.style.color = 'var(--text)';
          document.getElementById('user-name').value = '';
          document.getElementById('user-email').value = '';
          window.showToast(`Usu√°rio "${name}" criado com sucesso!`);
        }, 1000);
      });
    </script>
  </body>
</html>
