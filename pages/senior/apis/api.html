<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>API Playground ‚Äî QA Playground</title>
    <link rel="stylesheet" href="../../../css/main.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  </head>
  <body>
    <header class="et-header">
      <div class="et-header-inner">
        <a href="../../../index.html" class="et-logo" aria-label="In√≠cio">
          <img src="../../../assets/icons/logo.svg" alt="Logo QA Playground" height="40" />
        </a>
        <nav class="et-nav" aria-label="Navega√ß√£o principal">
          <ul class="et-nav-list">
            <li><a href="../../../index.html">In√≠cio</a></li>
            <li><a href="api.html" aria-current="page">API</a></li>
            <li><a href="../../pleno/tabelas/">Tabelas</a></li>
          </ul>
        </nav>
        <div class="et-header-actions">
          <button id="theme-toggle" aria-label="Alternar tema">üåû</button>
        </div>
      </div>
    </header>

    <main class="container">
      <section class="section">
        <div class="section-header">
          <h2>API Playground (Mock)</h2>
          <div class="section-desc">Simule chamadas de API REST para testar integra√ß√£o e valida√ß√£o de respostas. Endpoints mockados para pr√°tica de testes de API.</div>
        </div>

        <div class="subsections subsections-vertical">
          <div class="subsection">
            <h3>GET /users</h3>
            <p class="muted" style="margin-bottom: var(--spacing-md);">Buscar lista de usu√°rios (simulado).</p>
            <div class="controls">
              <button id="btn-fetch-users" class="btn" data-testid="btn-get-users">Buscar Usu√°rios</button>
              <button id="btn-clear-users" class="btn btn-secondary" data-testid="btn-clear-users">Limpar</button>
            </div>
            <pre 
              id="api-result-users" 
              data-testid="resultado-api-users"
              style="margin-top: var(--spacing-md); padding: var(--spacing-md); background: var(--surface); border-radius: var(--border-radius-md); border-left: 4px solid var(--accent); overflow-x: auto; font-size: var(--font-size-sm); min-height: 60px;"
            ><span class="muted">Nenhuma requisi√ß√£o realizada ainda.</span></pre>
          </div>

          <div class="subsection">
            <h3>POST /users</h3>
            <p class="muted" style="margin-bottom: var(--spacing-md);">Criar um novo usu√°rio (simulado).</p>
            <div class="form-grid">
              <div class="form-group">
                <label for="user-name">Nome</label>
                <input id="user-name" type="text" placeholder="Digite o nome" data-testid="input-nome-usuario" />
              </div>
              <div class="form-group">
                <label for="user-email">Email</label>
                <input id="user-email" type="email" placeholder="email@exemplo.com" data-testid="input-email-usuario" />
              </div>
              <div class="form-full">
                <button id="btn-create-user" class="btn" data-testid="btn-post-user">Criar Usu√°rio</button>
              </div>
            </div>
            <pre 
              id="api-result-post" 
              data-testid="resultado-api-post"
              style="margin-top: var(--spacing-md); padding: var(--spacing-md); background: var(--surface); border-radius: var(--border-radius-md); border-left: 4px solid var(--accent-2); overflow-x: auto; font-size: var(--font-size-sm); min-height: 60px;"
            ><span class="muted">Nenhuma requisi√ß√£o realizada ainda.</span></pre>
          </div>
        </div>

        <div class="subsection" style="margin-top: var(--spacing-lg);">
          <h3>Informa√ß√µes para Testes</h3>
          <div style="background: var(--surface); padding: var(--spacing-md); border-radius: var(--border-radius-md); border-left: 4px solid var(--accent);">
            <p style="margin-bottom: var(--spacing-sm);"><strong>Cen√°rios de Teste:</strong></p>
            <ul style="margin-left: var(--spacing-lg); color: var(--muted); font-size: var(--font-size-sm);">
              <li>Testar requisi√ß√µes GET e POST</li>
              <li>Validar status codes de resposta</li>
              <li>Verificar estrutura JSON das respostas</li>
              <li>Testar cria√ß√£o de recursos</li>
              <li>Validar tratamento de erros</li>
              <li>Testar timeouts e delays de resposta</li>
            </ul>
            
            <p style="margin-top: var(--spacing-md); margin-bottom: var(--spacing-sm);"><strong>Endpoints Mockados:</strong></p>
            <ul style="margin-left: var(--spacing-lg); color: var(--muted); font-size: var(--font-size-sm);">
              <li><code>GET /users</code> - Retorna lista de usu√°rios</li>
              <li><code>POST /users</code> - Cria um novo usu√°rio</li>
            </ul>

            <p style="margin-top: var(--spacing-md); margin-bottom: var(--spacing-sm);"><strong>Exemplos de Teste Automatizado:</strong></p>
            <pre style="background: var(--bg); padding: var(--spacing-md); border-radius: var(--border-radius-sm); overflow-x: auto; font-size: var(--font-size-sm);"><code>// Cypress - Testar API GET
cy.intercept('GET', '**/users', { fixture: 'users.json' }).as('getUsers');
cy.get('[data-testid="btn-get-users"]').click();
cy.wait('@getUsers');
cy.get('[data-testid="resultado-api-users"]').should('contain', 'users');

// Testar API POST
cy.get('[data-testid="input-nome-usuario"]').type('Jo√£o');
cy.get('[data-testid="input-email-usuario"]').type('joao@exemplo.com');
cy.get('[data-testid="btn-post-user"]').click();
cy.get('[data-testid="resultado-api-post"]').should('contain', 'Created');

// Playwright - Testar API
await page.getByTestId('btn-get-users').click();
await page.waitForTimeout(1000);
const result = await page.getByTestId('resultado-api-users').textContent();
expect(result).toContain('users');

// Selenium (Java) - Validar resposta da API
driver.findElement(By.cssSelector("[data-testid='btn-get-users']")).click();
Thread.sleep(1000);
WebElement result = driver.findElement(By.cssSelector("[data-testid='resultado-api-users']"));
assert result.getText().contains("users");

// Capybara (Ruby) - Testar API
click_button '[data-testid="btn-get-users"]'
sleep 1
expect(page).to have_content('users', within: '[data-testid="resultado-api-users"]')

// Robot Framework - Testar API
Click Button    [data-testid="btn-get-users"]
Sleep    1s
Element Should Contain    [data-testid="resultado-api-users"]    users</code></pre>

            <p style="margin-top: var(--spacing-md); margin-bottom: var(--spacing-sm);"><strong>Elementos identific√°veis:</strong></p>
            <ul style="margin-left: var(--spacing-lg); color: var(--muted); font-size: var(--font-size-sm);">
              <li><code>data-testid="btn-get-users"</code></li>
              <li><code>data-testid="btn-post-user"</code></li>
              <li><code>data-testid="resultado-api-users"</code></li>
              <li><code>data-testid="resultado-api-post"</code></li>
            </ul>
          </div>
        </div>

        <div style="margin-top: var(--spacing-xl); text-align: center;">
          <a href="../../../index.html" class="btn btn-secondary">‚Üê Voltar para In√≠cio</a>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      QA Playground ‚Äî Projeto educacional ‚Ä¢ Portugu√™s
    </footer>

    <script src="../../../js/main.js"></script>
    <script>
      let userCounter = 3;
      
      // GET /users
      document.getElementById('btn-fetch-users').addEventListener('click', () => {
        const resultEl = document.getElementById('api-result-users');
        resultEl.innerHTML = '<span class="muted">Carregando...</span>';
        resultEl.style.color = 'var(--muted)';
        
        setTimeout(() => {
          const users = [
            { id: 1, name: 'Ana Silva', email: 'ana@exemplo.com' },
            { id: 2, name: 'Bruno Costa', email: 'bruno@exemplo.com' }
          ];
          
          const response = {
            status: 200,
            statusText: 'OK',
            data: users,
            timestamp: new Date().toISOString()
          };
          
          resultEl.textContent = JSON.stringify(response, null, 2);
          resultEl.style.color = 'var(--text)';
          window.showToast(`GET /users retornou ${users.length} usu√°rios`);
        }, 800);
      });

      document.getElementById('btn-clear-users').addEventListener('click', () => {
        document.getElementById('api-result-users').innerHTML = '<span class="muted">Nenhuma requisi√ß√£o realizada ainda.</span>';
      });

      // POST /users
      document.getElementById('btn-create-user').addEventListener('click', () => {
        const name = document.getElementById('user-name').value.trim();
        const email = document.getElementById('user-email').value.trim();
        const resultEl = document.getElementById('api-result-post');
        
        if (!name || !email) {
          resultEl.innerHTML = JSON.stringify({
            status: 400,
            statusText: 'Bad Request',
            error: 'Nome e email s√£o obrigat√≥rios'
          }, null, 2);
          resultEl.style.color = 'var(--danger)';
          window.showToast('Erro: Preencha todos os campos');
          return;
        }
        
        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
          resultEl.innerHTML = JSON.stringify({
            status: 400,
            statusText: 'Bad Request',
            error: 'Email inv√°lido'
          }, null, 2);
          resultEl.style.color = 'var(--danger)';
          window.showToast('Erro: Email inv√°lido');
          return;
        }
        
        resultEl.innerHTML = '<span class="muted">Criando usu√°rio...</span>';
        resultEl.style.color = 'var(--muted)';
        
        setTimeout(() => {
          const newUser = {
            id: userCounter++,
            name: name,
            email: email,
            createdAt: new Date().toISOString()
          };
          
          const response = {
            status: 201,
            statusText: 'Created',
            data: newUser,
            message: 'Usu√°rio criado com sucesso',
            timestamp: new Date().toISOString()
          };
          
          resultEl.textContent = JSON.stringify(response, null, 2);
          resultEl.style.color = 'var(--text)';
          document.getElementById('user-name').value = '';
          document.getElementById('user-email').value = '';
          window.showToast(`Usu√°rio "${name}" criado com sucesso!`);
        }, 1000);
      });
    </script>
  </body>
</html>
