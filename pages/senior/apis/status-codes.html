<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Status Codes HTTP ‚Äî APIs e Autentica√ß√£o ‚Äî QA Playground</title>
    <link rel="stylesheet" href="../../../css/main.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  </head>
  <body>
    <header class="et-header">
      <div class="et-header-inner">
        <a href="../../../index.html" class="et-logo" aria-label="In√≠cio">
          <img src="../../../assets/icons/logo.svg" alt="Logo QA Playground" height="40" />
        </a>
        <nav class="et-nav" aria-label="Navega√ß√£o principal">
          <ul class="et-nav-list">
            <li><a href="../../../index.html">In√≠cio</a></li>
            <li><a href="index.html">APIs</a></li>
          </ul>
        </nav>
        <div class="et-header-actions">
          <button id="theme-toggle" aria-label="Alternar tema">üåû</button>
        </div>
      </div>
    </header>

    <main class="container">
      <section class="section">
        <div class="section-header">
          <h2>Status Codes HTTP ‚Äî Vis√£o Completa para QA</h2>
          <div class="section-desc">Guia completo de c√≥digos de status HTTP: o que validar, cen√°rios de teste e como reportar corretamente.</div>
        </div>

        <div class="info-box">
          <h3 style="color: var(--success);">2xx ‚Äî Sucesso</h3>
          
          <div style="margin-top: var(--spacing-md);">
            <h4>200 OK</h4>
            <p>Requisi√ß√£o processada com sucesso. Status padr√£o para GET, PUT, PATCH quando opera√ß√£o completa com sucesso.</p>
            <p><strong>Valida√ß√µes:</strong> Payload conforme schema, estrutura JSON v√°lida, tipos de dados corretos, campos obrigat√≥rios presentes, regras de neg√≥cio aplicadas, headers apropriados (Content-Type, Cache-Control).</p>
          </div>

          <div style="margin-top: var(--spacing-md);">
            <h4>201 Created</h4>
            <p>Recurso criado com sucesso. Deve ser usado em POST quando novo recurso √© criado no servidor.</p>
            <p><strong>Valida√ß√µes:</strong> Location header presente com URI absoluta do recurso criado, ID do recurso retornado no payload, dados completos do recurso criado (incluindo campos gerados pelo servidor), Content-Location header quando aplic√°vel.</p>
          </div>

          <div style="margin-top: var(--spacing-md);">
            <h4>202 Accepted</h4>
            <p>Requisi√ß√£o aceita para processamento ass√≠ncrono. Opera√ß√£o ser√° executada posteriormente. Cliente deve verificar status atrav√©s de endpoint fornecido.</p>
            <p><strong>Valida√ß√µes:</strong> Endpoint de status retornado (Location ou Link header), ID de processamento/job para rastreamento, documenta√ß√£o de como verificar status (polling, webhook, etc.), tempo estimado de processamento se dispon√≠vel.</p>
          </div>

          <div style="margin-top: var(--spacing-md);">
            <h4>204 No Content</h4>
            <p>Requisi√ß√£o bem-sucedida sem corpo de resposta. Comum em DELETE e PUT quando n√£o h√° necessidade de retornar dados.</p>
            <p><strong>Valida√ß√µes:</strong> Body obrigatoriamente vazio, headers relevantes presentes (ETag, Last-Modified se aplic√°vel), opera√ß√£o realmente executada (verificar estado do recurso), Content-Length: 0 ou header ausente.</p>
          </div>

          <div style="margin-top: var(--spacing-md); padding: var(--spacing-md); background: rgba(122, 168, 116, 0.1); border-radius: var(--border-radius-sm);">
            <p><strong>O que validar al√©m do status:</strong></p>
            <ul style="margin-left: var(--spacing-lg); margin-top: var(--spacing-sm);">
              <li>Estrutura do JSON conforme schema</li>
              <li>Tipos de dados corretos (string, number, boolean, etc.)</li>
              <li>Campos obrigat√≥rios presentes</li>
              <li>Regras de neg√≥cio aplicadas</li>
              <li>Valores dentro dos ranges esperados</li>
            </ul>
          </div>
        </div>

        <div class="info-box" style="margin-top: var(--spacing-xl);">
          <h3 style="color: var(--warning);">3xx ‚Äî Redirecionamento</h3>
          
          <div style="margin-top: var(--spacing-md);">
            <h4>301 Moved Permanently</h4>
            <p>Recurso movido permanentemente para nova URL.</p>
            <p><strong>O que validar:</strong> Location header com nova URL, cliente segue redirecionamento automaticamente, cache atualizado.</p>
          </div>

          <div style="margin-top: var(--spacing-md);">
            <h4>302 Found</h4>
            <p>Redirecionamento tempor√°rio. URL antiga ainda pode ser usada.</p>
            <p><strong>O que validar:</strong> Location header, comportamento do cliente, se redirecionamento √© seguido.</p>
          </div>

          <div style="margin-top: var(--spacing-md);">
            <h4>304 Not Modified</h4>
            <p>Recurso n√£o modificado desde √∫ltima requisi√ß√£o (cache).</p>
            <p><strong>O que validar:</strong> ETag ou If-None-Match funcionando, body vazio, headers de cache corretos.</p>
          </div>

          <div style="margin-top: var(--spacing-md); padding: var(--spacing-md); background: rgba(255, 193, 7, 0.1); border-radius: var(--border-radius-sm);">
            <p><strong>Quando testar:</strong> Migra√ß√µes de endpoints, mudan√ßas de dom√≠nio, otimiza√ß√µes de cache.</p>
            <p><strong>Riscos:</strong> Loops de redirecionamento, perda de dados em redirects, cache incorreto.</p>
          </div>
        </div>

        <div class="info-box" style="margin-top: var(--spacing-xl);">
          <h3 style="color: var(--danger);">4xx ‚Äî Erros do Cliente (QA ESSENCIAL)</h3>
          
          <div style="margin-top: var(--spacing-md);">
            <h4>400 Bad Request</h4>
            <p>Requisi√ß√£o malformada ou sintaticamente incorreta. Erro do cliente que impede processamento.</p>
            <p><strong>Valida√ß√µes:</strong> Mensagem de erro descritiva, campos problem√°ticos identificados no payload de erro, orienta√ß√£o sobre como corrigir, estrutura de erro consistente (ex: JSON com "errors" array).</p>
          </div>

          <div style="margin-top: var(--spacing-md);">
            <h4>401 Unauthorized</h4>
            <p>Requisi√ß√£o requer autentica√ß√£o. Credenciais ausentes, inv√°lidas ou expiradas. Diferente de 403 (autenticado mas sem permiss√£o).</p>
            <p><strong>Valida√ß√µes:</strong> Header WWW-Authenticate presente indicando esquema de autentica√ß√£o, mensagem clara sobre necessidade de autentica√ß√£o, n√£o exp√µe detalhes sobre credenciais inv√°lidas (evita user enumeration).</p>
          </div>

          <div style="margin-top: var(--spacing-md);">
            <h4>403 Forbidden</h4>
            <p>Cliente autenticado mas sem permiss√£o para acessar o recurso. Servidor entendeu a requisi√ß√£o mas recusa autorizar.</p>
            <p><strong>Valida√ß√µes:</strong> Diferen√ßa clara entre 401 (n√£o autenticado) e 403 (sem permiss√£o), mensagem explicando falta de autoriza√ß√£o sem expor estrutura de permiss√µes, n√£o retorna detalhes sobre recursos existentes que o usu√°rio n√£o pode acessar.</p>
          </div>

          <div style="margin-top: var(--spacing-md);">
            <h4>404 Not Found</h4>
            <p>Recurso n√£o encontrado no servidor. Endpoint pode existir mas recurso espec√≠fico (ID) n√£o foi encontrado, ou endpoint n√£o existe.</p>
            <p><strong>Valida√ß√µes:</strong> Mensagem gen√©rica que n√£o exp√µe estrutura interna (ex: "Resource not found" vs "Table users doesn't exist"), comportamento consistente para recursos inexistentes e endpoints inexistentes (ambos 404), n√£o revela se recurso existe mas usu√°rio n√£o tem acesso (deve ser 403).</p>
          </div>

          <div style="margin-top: var(--spacing-md);">
            <h4>405 Method Not Allowed</h4>
            <p>M√©todo HTTP usado n√£o √© permitido para este endpoint. Endpoint existe mas m√©todo n√£o √© suportado.</p>
            <p><strong>Valida√ß√µes:</strong> Header Allow obrigat√≥rio listando m√©todos permitidos (GET, POST, etc.), mensagem clara indicando m√©todo n√£o permitido, status correto mesmo quando m√©todo n√£o implementado.</p>
          </div>

          <div style="margin-top: var(--spacing-md);">
            <h4>409 Conflict</h4>
            <p>Conflito com estado atual do recurso. Requisi√ß√£o n√£o pode ser completada devido a conflito (ex: email duplicado, vers√£o desatualizada, recurso bloqueado).</p>
            <p><strong>Valida√ß√µes:</strong> Mensagem espec√≠fica explicando natureza do conflito, orienta√ß√£o sobre como resolver (ex: obter vers√£o atual e retentar, usar condicional headers), payload de erro com detalhes do conflito quando aplic√°vel.</p>
          </div>

          <div style="margin-top: var(--spacing-md);">
            <h4>422 Unprocessable Entity</h4>
            <p>Requisi√ß√£o bem formada sintaticamente mas semanticamente incorreta. Valida√ß√µes de neg√≥cio falharam.</p>
            <p><strong>Valida√ß√µes:</strong> Lista estruturada de erros por campo (array de objetos com campo, c√≥digo, mensagem), mensagens claras e acion√°veis, formato consistente (ex: JSON com "errors" contendo array de erros), c√≥digos de erro padronizados quando aplic√°vel.</p>
          </div>

          <div style="margin-top: var(--spacing-md);">
            <h4>429 Too Many Requests</h4>
            <p>Cliente excedeu limite de taxa de requisi√ß√µes (rate limiting). Muitas requisi√ß√µes em per√≠odo de tempo definido.</p>
            <p><strong>Valida√ß√µes:</strong> Headers X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Reset presentes, header Retry-After indicando quando retentar, mensagem clara sobre limite excedido, comportamento ap√≥s limite (bloqueio tempor√°rio, throttling, etc.).</p>
          </div>

          <div style="margin-top: var(--spacing-md); padding: var(--spacing-md); background: rgba(220, 53, 69, 0.1); border-radius: var(--border-radius-sm);">
            <p><strong>Cen√°rios reais de teste:</strong></p>
            <ul style="margin-left: var(--spacing-lg); margin-top: var(--spacing-sm);">
              <li>Payload inv√°lido (JSON malformado, tipos errados)</li>
              <li>Campos ausentes (obrigat√≥rios n√£o enviados)</li>
              <li>Valores fora de range (idade negativa, string muito longa)</li>
              <li>Valida√ß√µes de neg√≥cio (email duplicado, data futura inv√°lida)</li>
              <li>Autentica√ß√£o/autoriza√ß√£o (token inv√°lido, sem permiss√£o)</li>
            </ul>
          </div>
        </div>

        <div class="info-box" style="margin-top: var(--spacing-xl);">
          <h3 style="color: var(--danger);">5xx ‚Äî Erros do Servidor</h3>
          
          <div style="margin-top: var(--spacing-md);">
            <h4>500 Internal Server Error</h4>
            <p>Erro gen√©rico do servidor indicando falha inesperada no processamento. N√£o deve ser usado para erros de valida√ß√£o ou de neg√≥cio.</p>
            <p><strong>Valida√ß√µes:</strong> Mensagem gen√©rica que n√£o exp√µe detalhes t√©cnicos (stack traces, caminhos de arquivo, queries SQL), logs detalhados no servidor para debugging, identificador √∫nico do erro (error ID) para rastreamento, n√£o exp√µe informa√ß√µes sens√≠veis sobre infraestrutura.</p>
          </div>

          <div style="margin-top: var(--spacing-md);">
            <h4>502 Bad Gateway</h4>
            <p>Gateway ou proxy recebeu resposta inv√°lida de servidor upstream. Indica problema de comunica√ß√£o entre servi√ßos.</p>
            <p><strong>Valida√ß√µes:</strong> Distinguir entre problema de infraestrutura (upstream down) e aplica√ß√£o (upstream retornando erro), timeout de upstream documentado, mensagem indica problema tempor√°rio quando aplic√°vel, logs no gateway para diagn√≥stico.</p>
          </div>

          <div style="margin-top: var(--spacing-md);">
            <h4>503 Service Unavailable</h4>
            <p>Servi√ßo temporariamente indispon√≠vel devido a manuten√ß√£o, sobrecarga ou indisponibilidade de depend√™ncias. Indica que servi√ßo pode estar dispon√≠vel novamente ap√≥s per√≠odo.</p>
            <p><strong>Valida√ß√µes:</strong> Header Retry-After presente indicando quando retentar, mensagem clara diferenciando manuten√ß√£o programada de sobrecarga, status apropriado para circuit breaker aberto, indica√ß√£o se problema √© tempor√°rio ou requer a√ß√£o.</p>
          </div>

          <div style="margin-top: var(--spacing-md);">
            <h4>504 Gateway Timeout</h4>
            <p>Gateway n√£o recebeu resposta de servidor upstream dentro do tempo limite configurado. Timeout ocorreu antes da resposta chegar.</p>
            <p><strong>Valida√ß√µes:</strong> Timeout configurado e documentado, distin√ß√£o entre upstream lento vs inacess√≠vel, Retry-After quando aplic√°vel, logs indicando qual upstream falhou, mensagem indica que requisi√ß√£o pode ser retentada.</p>
          </div>

          <div style="margin-top: var(--spacing-md); padding: var(--spacing-md); background: rgba(220, 53, 69, 0.1); border-radius: var(--border-radius-sm);">
            <p><strong>Como simular:</strong> For√ßar erros no servidor, desconectar servi√ßos upstream, simular timeouts, sobrecarga.</p>
            <p><strong>Como reportar:</strong> Incluir timestamp, request completo (method, endpoint, headers, body), resposta recebida, logs do servidor (se dispon√≠vel), frequ√™ncia do erro.</p>
          </div>
        </div>

        <!-- Exemplos Pr√°ticos -->
        <div class="subsection" style="margin-top: var(--spacing-xl);">
          <h3>Teste Pr√°tico de Status Codes</h3>
          <p class="muted" style="margin-bottom: var(--spacing-md);">Teste diferentes status codes usando a API mockada. Selecione um cen√°rio e veja a resposta real.</p>
          
          <div class="form-group" style="margin-bottom: var(--spacing-md);">
            <label for="status-code-scenario">Cen√°rio de Status Code:</label>
            <select id="status-code-scenario" style="padding: var(--spacing-sm); border-radius: var(--border-radius-sm); border: 1px solid var(--border); background: var(--bg); color: var(--text); width: 100%; max-width: 400px;">
              <option value="success">‚úÖ 200 OK - Sucesso</option>
              <option value="error-400">‚ùå 400 Bad Request</option>
              <option value="error-401">üîí 401 Unauthorized</option>
              <option value="error-403">üö´ 403 Forbidden</option>
              <option value="error-404">üîç 404 Not Found</option>
              <option value="error-409">‚ö†Ô∏è 409 Conflict</option>
              <option value="error-422">üìã 422 Unprocessable Entity</option>
              <option value="error-429">‚è±Ô∏è 429 Too Many Requests</option>
              <option value="error-500">üí• 500 Internal Server Error</option>
              <option value="error-503">üîß 503 Service Unavailable</option>
              <option value="timeout">‚è≥ 504 Gateway Timeout</option>
            </select>
          </div>

          <div class="controls" style="margin-bottom: var(--spacing-md);">
            <button id="btn-test-status-code" class="btn">Testar Status Code</button>
            <button id="btn-clear-status-code" class="btn btn-secondary">Limpar</button>
          </div>

          <pre 
            id="status-code-result"
            style="padding: var(--spacing-md); background: var(--surface); border-radius: var(--border-radius-md); border-left: 4px solid var(--accent); overflow-x: auto; font-size: var(--font-size-sm); min-height: 100px;"
          ><span class="muted">Selecione um cen√°rio e clique em "Testar Status Code" para ver a resposta.</span></pre>

          <div style="margin-top: var(--spacing-md); padding: var(--spacing-md); background: rgba(122, 168, 116, 0.1); border-radius: var(--border-radius-sm);">
            <p style="margin-bottom: var(--spacing-sm);"><strong>üí° Como usar:</strong></p>
            <ul style="margin-left: var(--spacing-lg); font-size: var(--font-size-sm);">
              <li>Selecione um cen√°rio de status code acima</li>
              <li>Clique em "Testar Status Code" para fazer uma requisi√ß√£o GET /api/users</li>
              <li>A API retornar√° o status code selecionado com uma resposta de erro apropriada</li>
              <li>Use isso para validar como sua aplica√ß√£o trata diferentes c√≥digos HTTP</li>
            </ul>
            <p style="margin-top: var(--spacing-sm); font-size: var(--font-size-sm);">
              <strong>Nota:</strong> Em desenvolvimento, a API deve estar rodando em <code>http://localhost:3001</code>. Execute <code>npm run dev:api</code> se necess√°rio. Em produ√ß√£o, a API est√° dispon√≠vel automaticamente.
            </p>
          </div>
        </div>

        <div style="margin-top: var(--spacing-xl); display: flex; gap: var(--spacing-md); justify-content: space-between; flex-wrap: wrap;">
          <a href="metodos-http.html" class="btn btn-secondary">‚Üê Anterior: M√©todos HTTP</a>
          <a href="validacoes.html" class="btn">Pr√≥ximo: Valida√ß√µes</a>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      QA Playground ‚Äî Projeto educacional ‚Ä¢ Portugu√™s
    </footer>

    <script src="../../../js/api-config.js"></script>
    <script type="module" src="../../../js/index.js"></script>
    <script type="module">
      const API_BASE_URL = window.getApiBaseUrl ? window.getApiBaseUrl() : (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' ? 'http://localhost:3001/api' : '/api');

      async function testStatusCode() {
        const scenario = document.getElementById('status-code-scenario').value;
        const resultEl = document.getElementById('status-code-result');
        
        resultEl.innerHTML = '<span class="muted">Testando...</span>';
        resultEl.style.color = 'var(--muted)';

        try {
          const url = `${API_BASE_URL}/users?scenario=${scenario}`;
          const response = await fetch(url, {
            headers: {
              'Content-Type': 'application/json',
            },
          });

          const data = await response.json();
          const result = {
            status: response.status,
            statusText: response.statusText,
            headers: {
              'Content-Type': response.headers.get('Content-Type'),
            },
            body: data,
            scenario: scenario,
            timestamp: new Date().toISOString(),
          };

          resultEl.textContent = JSON.stringify(result, null, 2);
          resultEl.style.color = response.status >= 400 ? 'var(--danger)' : 'var(--text)';

          // Destacar o status code
          const statusColor = response.status >= 500 ? 'var(--danger)' : 
                             response.status >= 400 ? 'var(--warning)' : 
                             'var(--success)';
          resultEl.style.borderLeftColor = statusColor;

        } catch (error) {
          resultEl.textContent = JSON.stringify({
            error: 'Erro de conex√£o',
            message: error.message,
            hint: 'Verifique se a API est√° rodando: npm run dev:api',
          }, null, 2);
          resultEl.style.color = 'var(--danger)';
        }
      }

      document.getElementById('btn-test-status-code').addEventListener('click', testStatusCode);
      document.getElementById('btn-clear-status-code').addEventListener('click', () => {
        document.getElementById('status-code-result').innerHTML = '<span class="muted">Selecione um cen√°rio e clique em "Testar Status Code" para ver a resposta.</span>';
      });
    </script>
  </body>
</html>
