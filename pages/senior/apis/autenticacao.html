<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Autentica√ß√£o e Autoriza√ß√£o ‚Äî APIs e Autentica√ß√£o ‚Äî QA Playground</title>
    <link rel="stylesheet" href="../../../css/main.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  </head>
  <body>
    <header class="et-header">
      <div class="et-header-inner">
        <a href="../../../index.html" class="et-logo" aria-label="In√≠cio">
          <img src="../../../assets/icons/logo.svg" alt="Logo QA Playground" height="40" />
        </a>
        <nav class="et-nav" aria-label="Navega√ß√£o principal">
          <ul class="et-nav-list">
            <li><a href="../../../index.html">In√≠cio</a></li>
            <li><a href="index.html">APIs</a></li>
          </ul>
        </nav>
        <div class="et-header-actions">
          <button id="theme-toggle" aria-label="Alternar tema">üåû</button>
        </div>
      </div>
    </header>

    <main class="container">
      <section class="section">
        <div class="section-header">
          <h2>Autentica√ß√£o e Autoriza√ß√£o</h2>
          <div class="section-desc">Guia completo sobre m√©todos de autentica√ß√£o: API Key, Basic Auth, Bearer Token, OAuth 2.0 e JWT. Como testar cada m√©todo.</div>
        </div>

        <div class="info-box">
          <h3>API Key</h3>
          <p><strong>Mecanismo:</strong> Chave alfanum√©rica √∫nica identificando cliente ou aplica√ß√£o. Enviada via header customizado (X-API-Key) ou query parameter (menos seguro).</p>
          <p><strong>Formato:</strong> <code>X-API-Key: abc123def456ghi789</code> ou <code>?api_key=abc123def456ghi789</code></p>
          <p><strong>Cen√°rios de teste:</strong></p>
          <ul style="margin-left: var(--spacing-lg); margin-top: var(--spacing-sm);">
            <li>Chave v√°lida e ativa ‚Üí 200 OK</li>
            <li>Chave inv√°lida (formato incorreto) ‚Üí 401 Unauthorized</li>
            <li>Chave ausente ‚Üí 401 com mensagem clara</li>
            <li>Chave expirada ‚Üí 401 com indica√ß√£o de expira√ß√£o</li>
            <li>Chave revogada ‚Üí 401 com indica√ß√£o de revoga√ß√£o</li>
            <li>Chave de ambiente diferente (dev key em prod) ‚Üí 401</li>
            <li>Chave com permiss√µes insuficientes ‚Üí 403 Forbidden</li>
          </ul>
          <p><strong>Pontos de falha:</strong> Chave expirada sem renova√ß√£o, chave revogada mas ainda em uso, rate limit espec√≠fico por chave n√£o respeitado, permiss√µes granulares por chave n√£o validadas.</p>
          <p><strong>Vulnerabilidades comuns:</strong> Chave em query parameter (exposta em logs, hist√≥rico, referrers), aus√™ncia de rota√ß√£o peri√≥dica, chaves sem expira√ß√£o, chaves com permiss√µes muito amplas.</p>
        </div>

        <div class="info-box" style="margin-top: var(--spacing-xl);">
          <h3>HTTP Basic Authentication</h3>
          <p><strong>Mecanismo:</strong> Credenciais (username:password) codificadas em Base64 e enviadas no header Authorization. Esquema definido em RFC 7617.</p>
          <p><strong>Formato:</strong> <code>Authorization: Basic dXNlcm5hbWU6cGFzc3dvcmQ=</code> (onde a string √© base64(username:password))</p>
          <p><strong>Cen√°rios de teste:</strong></p>
          <ul style="margin-left: var(--spacing-lg); margin-top: var(--spacing-sm);">
            <li>Credenciais v√°lidas ‚Üí 200 OK</li>
            <li>Username incorreto ‚Üí 401 Unauthorized</li>
            <li>Password incorreto ‚Üí 401 Unauthorized</li>
            <li>Header Authorization ausente ‚Üí 401 com WWW-Authenticate: Basic</li>
            <li>Base64 malformado ‚Üí 401</li>
            <li>Caracteres especiais na senha (:, @, etc.) ‚Üí Validar encoding correto</li>
            <li>Usu√°rio desativado ‚Üí 401 ou 403 dependendo da implementa√ß√£o</li>
          </ul>
          <p><strong>Pontos de falha:</strong> Senha alterada sem invalidar sess√µes, usu√°rio desativado mas autentica√ß√£o ainda funciona, encoding UTF-8 vs ASCII, timeout de sess√£o n√£o implementado.</p>
          <p><strong>Vulnerabilidades comuns:</strong> Uso em HTTP sem criptografia (credenciais em texto claro), aus√™ncia de rota√ß√£o de senha, falta de rate limiting permite brute force, aus√™ncia de account lockout ap√≥s tentativas falhas.</p>
        </div>

        <div class="info-box" style="margin-top: var(--spacing-xl);">
          <h3>Bearer Token (JWT ou Opaque)</h3>
          <p><strong>Mecanismo:</strong> Token de acesso (JWT auto-contido ou token opaco) enviado no header Authorization usando esquema Bearer. Definido em RFC 6750.</p>
          <p><strong>Formato:</strong> <code>Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c</code></p>
          <p><strong>Cen√°rios de teste:</strong></p>
          <ul style="margin-left: var(--spacing-lg); margin-top: var(--spacing-sm);">
            <li>Token v√°lido e n√£o expirado ‚Üí 200 OK</li>
            <li>Token expirado (claim exp no passado) ‚Üí 401 Unauthorized</li>
            <li>Token inv√°lido (assinatura incorreta) ‚Üí 401</li>
            <li>Token ausente ‚Üí 401 com WWW-Authenticate: Bearer</li>
            <li>Token malformado (estrutura incorreta) ‚Üí 401</li>
            <li>Token de outro usu√°rio acessando recurso privado ‚Üí 403 Forbidden</li>
            <li>Token revogado (em blacklist) ‚Üí 401</li>
            <li>Algoritmo alterado (alg: none ou alg diferente) ‚Üí 401</li>
          </ul>
          <p><strong>Pontos de falha:</strong> Token expirado sem mecanismo de refresh, token revogado mas ainda aceito, assinatura n√£o validada corretamente, claims modificados ap√≥s emiss√£o, algoritmo de assinatura fraco ou n√£o validado.</p>
          <p><strong>Vulnerabilidades comuns:</strong> Token em query parameter (exposto em logs), aus√™ncia de refresh token mechanism, valida√ß√£o de assinatura permite algoritmo "none", secrets fracos ou expostos, falta de valida√ß√£o de expira√ß√£o (exp claim).</p>
        </div>

        <div class="info-box" style="margin-top: var(--spacing-xl);">
          <h3>OAuth 2.0</h3>
          <p><strong>Mecanismo:</strong> Framework de autoriza√ß√£o que permite aplica√ß√µes obter acesso limitado a recursos. Define fluxos de autoriza√ß√£o, tokens de acesso e refresh tokens. Especificado em RFC 6749.</p>
          <p><strong>Fluxos (Grant Types):</strong></p>
          <ul style="margin-left: var(--spacing-lg); margin-top: var(--spacing-sm);">
            <li><strong>Authorization Code:</strong> Para aplica√ß√µes web server-side. Mais seguro, c√≥digo trocado por token no backend.</li>
            <li><strong>Implicit:</strong> Para SPAs (deprecado em favor de Authorization Code com PKCE). Token retornado diretamente.</li>
            <li><strong>Client Credentials:</strong> Para comunica√ß√£o machine-to-machine. Sem envolvimento do usu√°rio.</li>
            <li><strong>Resource Owner Password:</strong> Para aplica√ß√µes altamente confi√°veis. Credenciais do usu√°rio trocadas por token.</li>
            <li><strong>PKCE:</strong> Extens√£o para Authorization Code, adiciona seguran√ßa para clientes p√∫blicos.</li>
          </ul>
          <p><strong>Cen√°rios de teste (Authorization Code):</strong></p>
          <ul style="margin-left: var(--spacing-lg); margin-top: var(--spacing-sm);">
            <li>Fluxo completo: obter authorization code ‚Üí trocar por access token ‚Üí usar token</li>
            <li>Refresh token: usar refresh token para obter novo access token</li>
            <li>Escopos: validar que apenas recursos com escopo adequado s√£o acess√≠veis</li>
            <li>Expira√ß√£o: access token e refresh token expiram corretamente</li>
            <li>Redirect URI: URI n√£o registrada ‚Üí rejei√ß√£o</li>
            <li>State parameter: ausente ou inv√°lido ‚Üí rejei√ß√£o (prote√ß√£o CSRF)</li>
            <li>Client credentials: client_id/secret incorretos ‚Üí 401</li>
            <li>Code reuse: c√≥digo usado duas vezes ‚Üí rejei√ß√£o</li>
          </ul>
          <p><strong>Pontos de falha:</strong> Token expirado sem refresh mechanism, escopo insuficiente para opera√ß√£o, redirect_uri n√£o validado permite token theft, client_id/secret comprometidos, state parameter n√£o validado permite CSRF.</p>
          <p><strong>Vulnerabilidades comuns:</strong> State parameter n√£o validado (CSRF), redirect_uri n√£o validado permite authorization code interception, escopos muito amplos (excesso de permiss√µes), PKCE n√£o implementado em clientes p√∫blicos, tokens n√£o revogados ap√≥s logout.</p>
        </div>

        <div class="info-box" style="margin-top: var(--spacing-xl);">
          <h3>JWT (JSON Web Token)</h3>
          <p><strong>Mecanismo:</strong> Token auto-contido composto por tr√™s partes (header.payload.signature) codificadas em Base64URL. Claims no payload definem identidade, permiss√µes e metadados. Especificado em RFC 7519.</p>
          <p><strong>Estrutura:</strong> <code>base64url(header).base64url(payload).base64url(signature)</code></p>
          <p><strong>Componentes:</strong></p>
          <ul style="margin-left: var(--spacing-lg); margin-top: var(--spacing-sm);">
            <li><strong>Header:</strong> Algoritmo de assinatura (alg) e tipo de token (typ: JWT)</li>
            <li><strong>Payload:</strong> Claims (sub, exp, iat, roles, custom claims)</li>
            <li><strong>Signature:</strong> Assinatura criptogr√°fica validando integridade</li>
          </ul>
          <p><strong>Cen√°rios de teste:</strong></p>
          <ul style="margin-left: var(--spacing-lg); margin-top: var(--spacing-sm);">
            <li>Estrutura v√°lida com tr√™s partes separadas por ponto</li>
            <li>Claims padr√£o: exp (expira√ß√£o), iat (emitido em), sub (subject), aud (audience)</li>
            <li>Claims customizados: roles, permissions, scopes</li>
            <li>Assinatura v√°lida com secret/chave correta</li>
            <li>Expira√ß√£o: token com exp no passado ‚Üí 401</li>
            <li>Algoritmo: validar apenas algoritmos permitidos (HS256, RS256)</li>
            <li>Token modificado: alterar payload e reenviar ‚Üí 401 (assinatura inv√°lida)</li>
            <li>Algoritmo alterado: mudar alg no header ‚Üí 401</li>
            <li>Secret/key incorreta ‚Üí 401</li>
          </ul>
          <p><strong>Pontos de falha:</strong> Token expirado sem refresh, assinatura n√£o validada permite tokens modificados, algoritmo "none" aceito, claims modificados ap√≥s emiss√£o, secret/chave fraca ou exposta.</p>
          <p><strong>Vulnerabilidades comuns:</strong> Valida√ß√£o de algoritmo n√£o restrita permite "none" (sem assinatura), aus√™ncia de valida√ß√£o de expira√ß√£o (exp claim), secrets fracos (curtos ou previs√≠veis), chaves p√∫blicas expostas, falta de valida√ß√£o de audience (aud claim), claims cr√≠ticos n√£o validados.</p>
        </div>

        <!-- Exemplos Pr√°ticos de Autentica√ß√£o -->
        <div class="subsection" style="margin-top: var(--spacing-xl);">
          <h3>Teste Pr√°tico de Autentica√ß√£o</h3>
          <p class="muted" style="margin-bottom: var(--spacing-md);">Teste diferentes cen√°rios de autentica√ß√£o usando a API mockada.</p>
          
          <div class="form-grid" style="margin-bottom: var(--spacing-md);">
            <div class="form-group">
              <label for="auth-email">Email</label>
              <input id="auth-email" type="email" placeholder="admin@example.com" value="admin@example.com" />
            </div>
            <div class="form-group">
              <label for="auth-password">Senha</label>
              <input id="auth-password" type="password" placeholder="admin123" value="admin123" />
            </div>
            <div class="form-full">
              <button id="btn-test-login" class="btn">Testar Login</button>
              <button id="btn-test-invalid-token" class="btn btn-secondary">Testar Token Inv√°lido</button>
              <button id="btn-test-no-token" class="btn btn-secondary">Testar Sem Token</button>
            </div>
          </div>

          <div id="auth-token-display" style="margin-bottom: var(--spacing-md); padding: var(--spacing-sm); background: var(--surface); border-radius: var(--border-radius-sm); font-size: var(--font-size-sm); display: none;">
            <strong>Token obtido:</strong> <code id="token-value" style="word-break: break-all;"></code>
          </div>

          <pre 
            id="auth-result"
            style="padding: var(--spacing-md); background: var(--surface); border-radius: var(--border-radius-md); border-left: 4px solid var(--accent); overflow-x: auto; font-size: var(--font-size-sm); min-height: 100px;"
          ><span class="muted">Teste diferentes cen√°rios de autentica√ß√£o acima.</span></pre>

          <div style="margin-top: var(--spacing-md); padding: var(--spacing-md); background: rgba(122, 168, 116, 0.1); border-radius: var(--border-radius-sm);">
            <p style="margin-bottom: var(--spacing-sm);"><strong>üí° Credenciais de teste:</strong></p>
            <ul style="margin-left: var(--spacing-lg); font-size: var(--font-size-sm);">
              <li><strong>Admin:</strong> <code>admin@example.com</code> / <code>admin123</code></li>
              <li><strong>User:</strong> <code>user@example.com</code> / <code>user123</code></li>
              <li><strong>Viewer:</strong> <code>viewer@example.com</code> / <code>viewer123</code></li>
            </ul>
            <p style="margin-top: var(--spacing-sm); font-size: var(--font-size-sm);">
              <strong>Cen√°rios test√°veis:</strong> Login v√°lido, credenciais inv√°lidas, token expirado, token ausente, token inv√°lido.
            </p>
          </div>
        </div>

        <div style="margin-top: var(--spacing-xl); display: flex; gap: var(--spacing-md); justify-content: space-between; flex-wrap: wrap;">
          <a href="validacoes.html" class="btn btn-secondary">‚Üê Anterior: Valida√ß√µes</a>
          <a href="testes-negativos.html" class="btn">Pr√≥ximo: Testes Negativos</a>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      QA Playground ‚Äî Projeto educacional ‚Ä¢ Portugu√™s
    </footer>

    <script src="../../../js/api-config.js"></script>
    <script type="module" src="../../../js/index.js"></script>
    <script type="module">
      const API_BASE_URL = window.getApiBaseUrl ? window.getApiBaseUrl() : (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' ? 'http://localhost:3001/api' : '/api');
      let currentToken = null;

      function displayAuthResult(result, isError = false) {
        const resultEl = document.getElementById('auth-result');
        resultEl.textContent = JSON.stringify(result, null, 2);
        resultEl.style.color = isError || result.status >= 400 ? 'var(--danger)' : 'var(--text)';
      }

      // Testar Login
      document.getElementById('btn-test-login').addEventListener('click', async () => {
        const email = document.getElementById('auth-email').value.trim();
        const password = document.getElementById('auth-password').value.trim();

        if (!email || !password) {
          displayAuthResult({ error: 'Preencha email e senha' }, true);
          return;
        }

        try {
          const response = await fetch(`${API_BASE_URL}/auth/login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password }),
          });

          const data = await response.json();
          const result = {
            status: response.status,
            statusText: response.statusText,
            request: { method: 'POST', endpoint: '/api/auth/login', body: { email } },
            response: data,
            timestamp: new Date().toISOString(),
          };

          if (response.status === 200 && data.data?.token) {
            currentToken = data.data.token;
            document.getElementById('auth-token-display').style.display = 'block';
            document.getElementById('token-value').textContent = currentToken;
          }

          displayAuthResult(result, response.status >= 400);

        } catch (error) {
          displayAuthResult({
            error: 'Erro de conex√£o',
            message: error.message,
            hint: 'Verifique se a API est√° rodando: npm run dev:api',
          }, true);
        }
      });

      // Testar Token Inv√°lido
      document.getElementById('btn-test-invalid-token').addEventListener('click', async () => {
        try {
          const response = await fetch(`${API_BASE_URL}/users`, {
            headers: {
              'Authorization': 'Bearer token-invalido-12345',
              'Content-Type': 'application/json',
            },
          });

          const data = await response.json();
          displayAuthResult({
            status: response.status,
            statusText: response.statusText,
            request: { method: 'GET', endpoint: '/api/users', headers: { Authorization: 'Bearer token-invalido-12345' } },
            response: data,
            timestamp: new Date().toISOString(),
          }, true);

        } catch (error) {
          displayAuthResult({ error: 'Erro de conex√£o', message: error.message }, true);
        }
      });

      // Testar Sem Token
      document.getElementById('btn-test-no-token').addEventListener('click', async () => {
        try {
          const response = await fetch(`${API_BASE_URL}/users`, {
            headers: { 'Content-Type': 'application/json' },
          });

          const data = await response.json();
          displayAuthResult({
            status: response.status,
            statusText: response.statusText,
            request: { method: 'GET', endpoint: '/api/users', headers: {} },
            response: data,
            timestamp: new Date().toISOString(),
          }, true);

        } catch (error) {
          displayAuthResult({ error: 'Erro de conex√£o', message: error.message }, true);
        }
      });
    </script>
  </body>
</html>
