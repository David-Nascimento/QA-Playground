<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Cypress Spies, Stubs e Clocks ‚Äî QA Playground</title>
    <link rel="stylesheet" href="../../../css/main.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  </head>
  <body>
    <header class="et-header">
      <div class="et-header-inner">
        <a href="../../../index.html" class="et-logo" aria-label="In√≠cio">
          <img src="../../../assets/icons/logo.svg" alt="Logo QA Playground" height="40" />
        </a>
        <nav class="et-nav" aria-label="Navega√ß√£o principal">
          <ul class="et-nav-list">
            <li><a href="../../../index.html">In√≠cio</a></li>
            <li><a href="index.html">Intera√ß√µes (S√™nior)</a></li>
            <li><a href="cypress.html" aria-current="page">Cypress</a></li>
          </ul>
        </nav>
        <div class="et-header-actions">
          <button id="theme-toggle" aria-label="Alternar tema">üåû</button>
        </div>
      </div>
    </header>

    <main class="container">
      <section class="section">
        <div class="section-header">
          <h2>Cypress Spies, Stubs e Clocks</h2>
          <div class="section-desc">Pratique t√©cnicas avan√ßadas de automa√ß√£o com Cypress: espi√µes (spies), stubs e manipula√ß√£o de tempo (clocks). Essas funcionalidades permitem controlar comportamentos externos e testar cen√°rios complexos de forma isolada.</div>
        </div>

        <div class="subsections subsections-vertical">
          <div class="subsection">
            <h3>Exemplo de Fun√ß√£o para Espionar (Spy)</h3>
            <p class="muted" style="margin-bottom: var(--spacing-md);">
              Use <code>cy.spy()</code> para observar chamadas de fun√ß√µes sem alterar seu comportamento.
            </p>
            <div class="controls" style="margin-bottom: var(--spacing-md);">
              <button id="btn-alert" class="btn" data-testid="btn-alert">Disparar alerta</button>
            </div>
            <div id="alert-result" data-testid="alert-result" style="padding: var(--spacing-md); background: var(--surface); border-radius: var(--border-radius-md); border-left: 4px solid var(--accent); min-height: 50px;">
              <p class="muted" style="margin: 0;">Nenhum alerta disparado ainda.</p>
            </div>
          </div>

          <div class="subsection">
            <h3>Exemplo de XHR/Fetch para Stub</h3>
            <p class="muted" style="margin-bottom: var(--spacing-md);">
              Use <code>cy.intercept()</code> ou <code>cy.stub()</code> para interceptar e mockar requisi√ß√µes HTTP.
            </p>
            <div class="controls" style="margin-bottom: var(--spacing-md);">
              <button id="btn-xhr" class="btn" data-testid="btn-xhr">Buscar dados simulados</button>
            </div>
            <div id="xhr-result" data-testid="xhr-result" style="padding: var(--spacing-md); background: var(--surface); border-radius: var(--border-radius-md); border-left: 4px solid var(--accent-2); min-height: 50px;">
              <p class="muted" style="margin: 0;">Nenhuma requisi√ß√£o realizada ainda.</p>
            </div>
          </div>

          <div class="subsection">
            <h3>Exemplo de Clock/Timer</h3>
            <p class="muted" style="margin-bottom: var(--spacing-md);">
              Use <code>cy.clock()</code> e <code>cy.tick()</code> para controlar o tempo e testar timers, delays e timeouts.
            </p>
            <div class="controls" style="margin-bottom: var(--spacing-md);">
              <button id="btn-timer" class="btn" data-testid="btn-timer">Iniciar timer de 3s</button>
              <button id="btn-reset-timer" class="btn btn-secondary" data-testid="btn-reset-timer">Resetar</button>
            </div>
            <div id="timer-result" data-testid="timer-result" style="padding: var(--spacing-md); background: var(--surface); border-radius: var(--border-radius-md); border-left: 4px solid var(--accent); min-height: 50px;">
              <p class="muted" style="margin: 0;">Timer n√£o iniciado.</p>
            </div>
          </div>

          <div class="subsection" style="margin-top: var(--spacing-lg);">
            <h3>Informa√ß√µes para Testes</h3>
            <div style="background: var(--surface); padding: var(--spacing-md); border-radius: var(--border-radius-md); border-left: 4px solid var(--accent);">
              <p style="margin-bottom: var(--spacing-sm);"><strong>Cen√°rios de Teste:</strong></p>
              <ul style="margin-left: var(--spacing-lg); color: var(--muted); font-size: var(--font-size-sm);">
                <li>Espionar chamadas de fun√ß√µes (window.alert, console.log, etc.)</li>
                <li>Interceptar e mockar requisi√ß√µes HTTP (fetch, XMLHttpRequest)</li>
                <li>Controlar timers e delays para testes mais r√°pidos</li>
                <li>Validar que fun√ß√µes foram chamadas com os par√¢metros corretos</li>
                <li>Testar comportamentos ass√≠ncronos de forma determin√≠stica</li>
              </ul>
              
              <p style="margin-top: var(--spacing-md); margin-bottom: var(--spacing-sm);"><strong>Exemplos de Teste Automatizado:</strong></p>
              
              <div class="test-tabs">
                <button class="test-tab active" data-target="tab-cypress">Cypress</button>
                <button class="test-tab" data-target="tab-playwright">Playwright</button>
                <button class="test-tab" data-target="tab-selenium-java">Selenium (Java)</button>
                <button class="test-tab" data-target="tab-capybara">Capybara (Ruby)</button>
                <button class="test-tab" data-target="tab-robot">Robot Framework</button>
              </div>
              
              <div class="test-tab-content">
              
                <pre id="tab-cypress" class="test-code active"><code>
// Cypress - Espiar fun√ß√£o alert
cy.window().then((win) => {
  cy.stub(win, 'alert').as('alertStub')
})
cy.get('[data-testid="btn-alert"]').click()
cy.get('@alertStub').should('have.been.called')

// Interceptar fetch
cy.intercept('GET', '**/users/1', { fixture: 'user.json' }).as('getUser')
cy.get('[data-testid="btn-xhr"]').click()
cy.wait('@getUser')

// Controlar timer
cy.clock()
cy.get('[data-testid="btn-timer"]').click()
cy.tick(3000)
cy.get('[data-testid="timer-result"]').should('contain', 'Timer finalizado')
                </code></pre>
              
                <pre id="tab-playwright" class="test-code"><code>
// Playwright - Espiar e stub
await page.route('**/users/1', route => route.fulfill({ json: { name: 'Mock User' } }))
await page.getByTestId('btn-xhr').click()

// Controlar timer
await page.getByTestId('btn-timer').click()
await page.waitForTimeout(3000)
await expect(page.getByTestId('timer-result')).toContainText('Timer finalizado')
                </code></pre>
              
                <pre id="tab-selenium-java" class="test-code"><code>
// Selenium (Java) - Interceptar requisi√ß√µes (requer biblioteca adicional)
// Use bibliotecas como WireMock ou MockServer para interceptar requisi√ß√µes
// Ou use Chrome DevTools Protocol para interceptar requisi√ß√µes

// Controlar timer (simula√ß√£o)
driver.findElement(By.cssSelector("[data-testid='btn-timer']")).click();
Thread.sleep(3000);
WebElement result = driver.findElement(By.cssSelector("[data-testid='timer-result']"));
assert result.getText().contains("Timer finalizado");
                </code></pre>
              
                <pre id="tab-capybara" class="test-code"><code>
# Capybara (Ruby) - Stub de requisi√ß√µes
page.driver.browser.execute_script("window.fetch = function() { return Promise.resolve({json: () => Promise.resolve({name: 'Mock User'})}); }")
click_button '[data-testid="btn-xhr"]'

# Controlar timer
click_button '[data-testid="btn-timer"]'
sleep 3
expect(page).to have_content('Timer finalizado', within: '[data-testid="timer-result"]')
                </code></pre>
                  
                <pre id="tab-robot" class="test-code"><code>
*** Test Cases ***
Interceptar requisi√ß√µes
    # Use bibliotecas como requests-mock ou configure proxy
    # Para timer, aguarde o tempo necess√°rio
    Click Element    css:[data-testid="btn-timer"]
    Sleep    3s
    Element Should Contain    css:[data-testid="timer-result"]    Timer finalizado
                </code></pre>
              
              </div>

              <p style="margin-top: var(--spacing-md); margin-bottom: var(--spacing-sm);"><strong>Elementos identific√°veis:</strong></p>
              <ul style="margin-left: var(--spacing-lg); color: var(--muted); font-size: var(--font-size-sm);">
                <li><code>data-testid="btn-alert"</code> - Bot√£o para disparar alerta</li>
                <li><code>data-testid="alert-result"</code> - Resultado do alerta</li>
                <li><code>data-testid="btn-xhr"</code> - Bot√£o para buscar dados</li>
                <li><code>data-testid="xhr-result"</code> - Resultado da requisi√ß√£o</li>
                <li><code>data-testid="btn-timer"</code> - Bot√£o para iniciar timer</li>
                <li><code>data-testid="timer-result"</code> - Resultado do timer</li>
              </ul>
            </div>
          </div>
        </div>

        <div style="margin-top: var(--spacing-xl); text-align: center;">
          <a href="../../../index.html" class="btn btn-secondary">‚Üê Voltar para In√≠cio</a>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      QA Playground ‚Äî Projeto educacional ‚Ä¢ Portugu√™s
    </footer>

    <script src="../../../js/main.js"></script>
    <script>
      // Fun√ß√£o para espiar com Cypress
      document.getElementById('btn-alert').addEventListener('click', function() {
        window.alert('Alerta disparado! Esta fun√ß√£o pode ser espionada com cy.spy() ou cy.stub().');
        const resultEl = document.getElementById('alert-result');
        const timestamp = new Date().toLocaleTimeString('pt-BR');
        resultEl.innerHTML = `
          <p style="margin: 0 0 var(--spacing-sm) 0;"><strong>‚úÖ Alerta disparado:</strong></p>
          <p style="margin: 0; color: var(--muted);">A fun√ß√£o window.alert() foi chamada</p>
          <p style="margin: var(--spacing-sm) 0 0 0; font-size: var(--font-size-sm); color: var(--muted);">Hor√°rio: ${timestamp}</p>
        `;
      });

      // Simula√ß√£o de XHR/Fetch para stub
      document.getElementById('btn-xhr').addEventListener('click', function() {
        const resultEl = document.getElementById('xhr-result');
        resultEl.innerHTML = '<span class="muted">Carregando...</span>';
        
        // Simular delay de rede
        setTimeout(() => {
          // Dados mockados (em um teste real, voc√™ usaria cy.intercept())
          const mockData = {
            id: 1,
            name: 'Jo√£o Silva',
            email: 'joao@exemplo.com',
            username: 'joaosilva'
          };
          
          const timestamp = new Date().toLocaleTimeString('pt-BR');
          resultEl.innerHTML = `
            <p style="margin: 0 0 var(--spacing-sm) 0;"><strong>‚úÖ Dados recebidos:</strong></p>
            <pre style="margin: 0; font-size: var(--font-size-sm); color: var(--muted);">${JSON.stringify(mockData, null, 2)}</pre>
            <p style="margin: var(--spacing-sm) 0 0 0; font-size: var(--font-size-sm); color: var(--muted);">Hor√°rio: ${timestamp}</p>
          `;
          window.showToast('Dados carregados com sucesso!');
        }, 800);
      });

      // Timer para clock
      let timerInterval = null;
      let timerSeconds = 0;
      
      document.getElementById('btn-timer').addEventListener('click', function() {
        const resultEl = document.getElementById('timer-result');
        const btn = this;
        
        if (timerInterval) {
          clearInterval(timerInterval);
        }
        
        timerSeconds = 0;
        btn.disabled = true;
        resultEl.innerHTML = '<span class="muted">Timer iniciado... 0s</span>';
        
        timerInterval = setInterval(() => {
          timerSeconds++;
          resultEl.innerHTML = `<span class="muted">Timer em execu√ß√£o... ${timerSeconds}s</span>`;
          
          if (timerSeconds >= 3) {
            clearInterval(timerInterval);
            timerInterval = null;
            btn.disabled = false;
            const timestamp = new Date().toLocaleTimeString('pt-BR');
            resultEl.innerHTML = `
              <p style="margin: 0 0 var(--spacing-sm) 0;"><strong>‚úÖ Timer finalizado:</strong></p>
              <p style="margin: 0; color: var(--muted);">Timer de 3 segundos conclu√≠do</p>
              <p style="margin: var(--spacing-sm) 0 0 0; font-size: var(--font-size-sm); color: var(--muted);">Hor√°rio: ${timestamp}</p>
            `;
            window.showToast('Timer finalizado!');
          }
        }, 1000);
      });
      
      document.getElementById('btn-reset-timer').addEventListener('click', function() {
        if (timerInterval) {
          clearInterval(timerInterval);
          timerInterval = null;
        }
        document.getElementById('btn-timer').disabled = false;
        document.getElementById('timer-result').innerHTML = '<p class="muted" style="margin: 0;">Timer n√£o iniciado.</p>';
      });

      // Inicializar abas de teste automatizado
      (function() {
        function initTabs() {
          const tabsContainer = document.querySelector('.test-tabs');
          
          if (!tabsContainer) {
            setTimeout(initTabs, 100);
            return;
          }

          const tabs = tabsContainer.querySelectorAll('.test-tab');
          tabs.forEach(tab => {
            tab.addEventListener('click', function(e) {
              e.preventDefault();
              e.stopPropagation();
              
              const targetId = this.dataset.target;
              if (!targetId) return;
              
              // Remove active de todas as abas
              tabs.forEach(t => t.classList.remove('active'));
              document.querySelectorAll('.test-code').forEach(c => c.classList.remove('active'));

              // Adiciona active na aba clicada
              this.classList.add('active');
              const targetContent = document.getElementById(targetId);
              if (targetContent) {
                targetContent.classList.add('active');
              }
            });
          });
        }

        // Aguardar DOM estar pronto
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initTabs);
        } else {
          setTimeout(initTabs, 50);
        }
      })();
    </script>
  </body>
</html>
